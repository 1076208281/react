<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[React]]></title><description><![CDATA[A JavaScript library for building user interfaces]]></description><link>https://doc.react-china.org</link><generator>RSS for Node</generator><lastBuildDate>Sun, 11 Feb 2018 03:05:02 GMT</lastBuildDate><item><title><![CDATA[Behind the Scenes: Improving the Repository Infrastructure]]></title><description><![CDATA[<p>随着我们不断地在 <a href="/blog/2017/09/26/react-v16.0.html">React 16</a> 的投入，我们在 React 仓库中对其目录结构和大量的构建工具进行了改版。此外，我们将类似 <a href="https://rollupjs.org/">Rollup</a>， <a href="https://prettier.io/">Prettier</a>，和 <a href="https://developers.google.com/closure/compiler/">Google Closure Compiler</a> 引入到我们的工作流中。其他开发者通常会问我们在项目中如何使用这些工具等问题。在本篇博客中，我们将分享一些我们在 2017 年在构建工具和测试等基础架构上所做的一些改变，以及激励他们尝试的原因。</p>
<p>尽管这些改变帮助我们将 React 变得更好，但他们并不会直接影响大多数 React 用户。然而，我们希望能够在博客中将其记录下来以能够帮助到其他库的作者来解决类似问题。我们的贡献者可能也会发现这些记录非常有用。</p>
<h2 id="通过-prettier-格式化代码"><a href="#%E9%80%9A%E8%BF%87-prettier-%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>通过 Prettier 格式化代码</h2>
<p>React 是第一个<a href="https://github.com/facebook/react/pull/9101">完全拥抱</a><a href="https://prettier.io/">Prettier</a>的大型软件库之一，通过其来自动格式化代码。我们当前的 Prettier 配置组成：</p>
<ul>
<li><a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/prettier/index.js#L71-L77">使用 Prettier Node API 的</a>本地的 <a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/package.json#L115"><code>yarn prettier</code></a> 命令来格式化文件。我们一般在提交变更之前运行。其非常快，因为其仅检查<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/shared/listChangedFiles.js#L29-L33">之前从远程服务器下发的变更文件</a>。</li>
<li><a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/prettier/index.js#L79-L90">运行 Prettier</a> 脚本是我们<a href="https://github.com/facebook/react/blob/d906de7f602df810c38aa622c83023228b047db6/scripts/circleci/test_entry_point.sh#L10">持续集成检查</a>的一部分。其不会尝试重写文件，但其仍有可能构建失败若任何文件和 Prettier 输出的文件不同。这确保了除非其已经被完全格式化，否则我们无法合并提交请求。</li>
</ul>
<p>一部分团队成员也已经将其设置为<a href="https://prettier.io/docs/en/editors.html">编译器集成</a>。我们对 Preuttier 的体验非常棒，我们也推荐给其他任何写 JavaScript 的团队。</p>
<h2 id="重组成单一仓库"><a href="#%E9%87%8D%E7%BB%84%E6%88%90%E5%8D%95%E4%B8%80%E4%BB%93%E5%BA%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>重组成单一仓库</h2>
<p>自从 React 被分解成包，其已经成为了的<a href="https://danluu.com/monorepo/">独立库（monorepo）</a>：一系列的包被放在一个单独的库下。这使得其更容易进行调整和共用工具，但我们的目录结构嵌套过深以致于难以理解。哪个文件归属于哪个包并不是很清晰。自 React 16 发布之后，我们决定完全重新调整仓库结构。这就是我们的成果。</p>
<h3 id="迁移到-yarn"><a href="#%E8%BF%81%E7%A7%BB%E5%88%B0-yarn" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>迁移到 Yarn</h3>
<p>Yarn 包管理工具在几个月前<a href="https://yarnpkg.com/blog/2017/08/02/introducing-workspaces/">引入了一种称为工作间（Workspaces）的特性</a>。这一特性能够让你告诉 Yarn 你的独立库的包在文件目录的什么位置。每一次你运行 <code>yarn</code>，除了安装你的依赖它还会设置从你项目的 <code>node_modules</code> 指向你的包的资源文件的符号链接（symlink）。</p>
<p>由于有工作间，我们自己的包之间的完全引入（例如从 <code>react-dom</code> 中引入 <code>react</code>）仅能够和任何支持 Node 解析机制的工具一起使用。我们遇到的唯一问题则是 Jest 没有在链接包内部进行转换，但我们<a href="https://github.com/facebook/jest/pull/4761">发现了修复办法</a>，并将其合并到 Jest 中。</p>
<p>为支持 Yarn 工作间，我们增加了 <code>"workspaces": ["packages/*"]</code> 到我们的 <a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/package.json#L4-L6"><code>package.json</code></a> 中，并将所有的代码移入到<a href="https://github.com/facebook/react/tree/cc52e06b490e0dc2482b345aa5d0d65fae931095/packages">顶层的 <code>packages/*</code> 文件夹中</a>，每个都有单独的 <code>package.json</code> 文件</p>
<p>每个包以相同的方式组织。对于每一个公开的 API 入口如 <code>react-dom</code> 或 <code>react-dom/server</code>，在包的根目录下有一个文件对来自 <code>/src/</code> 下的子目录重新暴露。将入口指向源代码而不是构建版本是有意而为之。通常，我们在开发期间会在每一次变更后重新运行部分测试。必须进行构建项目来运行测试会出奇的慢。当我们将包发布到 npm 时，我们再在 <code>/npm/</code> 文件夹下将入口文件指向构建版本。</p>
<p>并不是所有包都要发布到 npm 上。例如，我们保留一些很小的工具函数并可以安全地复制到一个<a href="https://github.com/facebook/react/tree/cc52e06b490e0dc2482b345aa5d0d65fae931095/packages/shared">称为 <code>shared</code> 的伪包</a>。我们的打包器被配置成<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/rollup/build.js#L326-L329">仅会将声明在 <code>package.json</code> 的 <code>dependencies</code> 中的项目作为第三方库</a>，因此其可以很顺利地将 <code>shared</code> 的代码打包到 <code>react</code> 和 <code>react-dom</code> 中而不会在构建版本中留下任何对 <code>shared/</code> 的引用。因此你也可以使用 Yarn 工作间即使你不打算发布实际的 npm 包！</p>
<h3 id="移除自定义模块系统"><a href="#%E7%A7%BB%E9%99%A4%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>移除自定义模块系统</h3>
<p>过去，我们使用了一个称为 “Haste” 的非标准模块系统，其能够让我们通过唯一的 <code>@providesModule</code> 从其他文件引用在其他任何地方的任何文件。其完全避免了类似 <code>../../../../</code> 相对路径过深的引用问题并且对于生产代码来说很棒。然而，这使得在包之间很难理解其依赖关系。我们也不得不重新调整这一黑科技使其能和不同的工具一同运行。</p>
<p>我们决定 <a href="https://github.com/facebook/react/pull/11303">移除 Haste</a> 并使用 Node 的相对引用的解析机制来代替。为避免相对路径过深的问题，我们将<a href="https://github.com/facebook/react/pull/11304">我们的仓库结构进行扁平化处理</a> 所以在每个包内部之多有一层深度：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-none"><code>|-react
|  |-npm
|  |-src
|-react-dom
|  |-npm
|  |-src
|  |  |-client
|  |  |-events
|  |  |-server
|  |  |-shared</code></pre>
      </div>
<p>这样，其相对路径只会包含一个 <code>./</code> 或 <code>../</code>，后跟文件名。若一个包需要引入另外一个，其可以通过绝对路径从顶层入口来引入。</p>
<p>实践中，我们仍然会有<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/packages/react-dom/src/client/ReactDOMFiberComponent.js#L10-L11">一些跨包间的“内部”引入</a>。其打破了这一原则，但很明确，我们计划逐渐摆脱这一方式。</p>
<h2 id="编译成扁平化的包"><a href="#%E7%BC%96%E8%AF%91%E6%88%90%E6%89%81%E5%B9%B3%E5%8C%96%E7%9A%84%E5%8C%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编译成扁平化的包</h2>
<p>历史上，React 被分成两种不同的形式：作为一个单文件构建版本以让你能够在浏览器中通过一个 <code>&#x3C;script></code> 标签引用，和作为 CommonJS 模块的集合以让你能够通过类似 webpack 或 Browserify 来进行打包。</p>
<p>React 16 之前，作为 npm 包发布的组成部分的每个 React 源文件对应着一个 CommonJS 模块。导入 <code>react</code> 或 <code>react-dom</code> 使得打包器从它们通过 CommonJS 模块在<a href="https://unpkg.com/react@15/lib/">内部的 <code>lib</code> 文件夹</a>构建的依赖树作为<a href="https://unpkg.com/react@15/lib/">入口</a>。</p>
<p>然而，这一方式有诸多缺点：</p>
<ul>
<li><strong>不一致</strong> 不同的工具对于引入相同的 React 代码会产生不同的尺寸，相差最多会达到 30 kB（gzip 之前）。</li>
<li><strong>对于打包器用户来说非常低效</strong> 现今大多数打包器会在模块边界产生大量的 “胶水代码”。其让模块间能够相互独立，但增加了解析时间，包的尺寸以及构建时间。</li>
<li><strong>对于 Node 用户来说非常低效</strong> 当在 Node 环境下运行时，在针对开发模式的代码执行前运行 <code>process.env.NODE_ENV</code> 会由于其检查环境变量而带来二娃的开销。这拖慢了 React 服务端渲染。我们也无法缓存到一个变量内，因为其妨碍了 Uglify 进行无用代码的擦除。</li>
<li><strong>破坏了封装</strong> React 内部文件同时被暴露在开源社区（通过 <code>react-dom/lib/*</code> 引入）和 Facebook 内部。首先其是一种非常方便在项目内共享工具函数的方式，但同时这也增加了维护成本，因为重命名或改变内部函数的参数类型都可能会破坏不相关的项目。</li>
<li><strong>妨碍新特性实验</strong> 对于 React 团队来说没有其他方式来实验任何新的编译技术。例如，理论上，我们可能会想要应用<a href="https://developers.google.com/closure/compiler/docs/api-tutorial3">新的 Google Closure Compiler</a> 压缩或 <a href="https://prepack.io/">Prepack</a> 来处理我们的部分代码，但他们被设计成是针对完整的包而不是我们曾经发布到 npm 的小的独立模块。</li>
</ul>
<p>由于这样那样的问题，我们在 React 16 调整了策略。对于 Node.js 和打包器我们仍发布到 CommonJS 模块，每一个入口我们仅发布两个 CommonJS 包而不是在 npm 包中发布许多独立的文件</p>
<p>例如，当你在 React 16 引入 <code>react</code> 时，打包器会发现<a href="https://unpkg.com/react@16/index.js">入口</a>，只需要重新导出两个文件中的一个：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./cjs/react.production.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./cjs/react.development.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>In every package provided by React, the <a href="https://unpkg.com/react@16/cjs/"><code>cjs</code> folder</a> (short for “CommonJS”) contains a development and a production pre-built bundle for each entry point. </p>
<p>For example, <a href="https://unpkg.com/react@16/cjs/react.development.js"><code>react.development.js</code></a> is the version intended for development. It is readable and includes comments. On the other hand, <a href="https://unpkg.com/react@16/cjs/react.production.min.js"><code>react.production.min.js</code></a> was minified and optimized before it was published to npm.</p>
<p>注意这和我们之前使用的单文件的浏览器构建策略实质上是非常相似的（现在仅是重新规划到 <a href="https://unpkg.com/react@16/umd/"><code>umd</code> 目录</a>下，<a href="https://www.davidbcalhoun.com/2014/what-is-amd-commonjs-and-umd/">通用模块定义（Universal Module Definition）</a>的缩写）。现在我们也对 CommonJS 构建采用同样的策略。</p>
<h3 id="迁移至-rollup"><a href="#%E8%BF%81%E7%A7%BB%E8%87%B3-rollup" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>迁移至 Rollup</h3>
<p>仅仅是将 CommonJS 模块编译成单文件包并不能解决之前的所有问题。而真正标志性的胜利是将我们的打包系统从 Browserify 到 <a href="https://rollupjs.org/">Rollup</a><a href="https://github.com/facebook/react/pull/9327">迁移</a>。</p>
<p><a href="https://medium.com/webpack/webpack-and-rollup-the-same-but-different-a41ad427058c">Rollup 本质上被设计成针对库而不是应用</a>，其非常适合 React 这样的用例。它非常好的解决了一个问题：如何将多个模块的代码通过非常小的垃圾代码整合到一个扁平化文件中。为了达到这一要求，其将所有的代码放到同一作用域下并重命名变量以保证他们不会冲突，而非像其他打包器一样将模块变成函数。这样产生的代码更易于 JavaScript 引擎解析，易于阅读，也易于压缩器优化。</p>
<p>Rollup 目前还不支持一些对于应用构建来说非常重要的特性，例如代码分隔。然而，其并不算致力于替换掉诸如非常擅长处理这类工作的 webpack。Rollup 非常适合如 React 等 <em>框架</em>，因为其能够被预构建而后被集成到应用中。</p>
<p>你可以在<a href="https://github.com/facebook/react/blob/8ec146c38ee4f4c84b6ecf59f52de3371224e8bd/scripts/rollup/build.js#L336-L362">这里</a>找到我们的 Rollup 构建配置，和<a href="https://github.com/facebook/react/blob/8ec146c38ee4f4c84b6ecf59f52de3371224e8bd/scripts/rollup/build.js#L196-L273">当前我们在用的一系列插件</a>。</p>
<h3 id="迁移至-google-closure-compiler"><a href="#%E8%BF%81%E7%A7%BB%E8%87%B3-google-closure-compiler" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>迁移至 Google Closure Compiler</h3>
<p>在迁移至扁平化包之后，我们开始在 <a href="https://github.com/google/closure-compiler-js">JavaScript 版本的 Google Closure Compiler</a> 下使用它的“简单”模式。根据我们的经验，即使先进的压缩技术不可用，其仍然能够明显优于 Uglify，由于其能够更好的消除无用代码和在适当的时候内联函数。</p>
<p>首先，我们可以对我们发布到开源社区仅使用 Google Closure Compiler。在 Facebook，我们仍然需要检查包来解压，以让我们能够在 React 生产环境崩溃时候能够通过我们的错误报告工具进行定位（symbolicate）。我们通过设置了一个完全禁止编译器重命名的<a href="https://github.com/google/closure-compiler/pull/2707">标志</a>来完成开发。这使得我们应用其他如函数内联（function inlining），但为 Facebook 特定的 React 构建版本保留了完整的代码可读性。为了提高输出的可读性，我们<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/rollup/build.js#L249-L250">也使用 Prettier 来自定义构建</a>。有趣的是，在调试构建的过程时运行生产版本的构建包是在构建包里发现无用代码的一种很好的方式。</p>
<p>当前，所有 React 的产品包 <a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/rollup/build.js#L235-L248">通过在 Google Closure Compiler 简单模式下运行</a>，同时我们也期望能够在未来支持更先进的优化方案。</p>
<h3 id="防止若无用代码被擦除"><a href="#%E9%98%B2%E6%AD%A2%E8%8B%A5%E6%97%A0%E7%94%A8%E4%BB%A3%E7%A0%81%E8%A2%AB%E6%93%A6%E9%99%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>防止若无用代码被擦除</h3>
<p>当我们在 React 上使用一个有效的<a href="https://en.wikipedia.org/wiki/Dead_code_elimination">无用代码擦除</a>方案时，我们无法对 React 用户使用的工具做许多的假设。</p>
<p>通常，当你<a href="/docs/optimizing-performance.html#use-the-production-build">在为生产环境配置一个打包器</a>时，你需要告诉它通过 <code>"production"</code>字符串替换掉 <code>process.env.NODE_ENV</code>。这一环节有时候被称为“环境检查（envification）”。思考这一代码：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">!==</span> <span class="token string">"production"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// development-only code</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>在环境检查后，这一判断条件将会永远为 <code>false</code>，并会被大多数压缩器完全擦除：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"production"</span> <span class="token operator">!==</span> <span class="token string">"production"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// development-only code</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>然而，若打包器被误配置，你可能意外地将开发版本的代码发布到生产环境中。我们无法阻止这一问题，但当发生时，我们可以设置一些步骤减少一些常见的用例。</p>
<h4 id="防止过晚环境检查"><a href="#%E9%98%B2%E6%AD%A2%E8%BF%87%E6%99%9A%E7%8E%AF%E5%A2%83%E6%A3%80%E6%9F%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>防止过晚环境检查</h4>
<p>如之前提到，我们的入口现在看起来像这样：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./cjs/react.production.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./cjs/react.development.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>然而，一些打包器会在环境检查之前执行 <code>require</code>。在这样的情况，即使 <code>else</code> 无法执行，文件 <code>cjs/react.development.js</code> 仍然会被打包。</p>
<p>为了防止这一情况，我们也将整个开发版本的 <code>cjs/react.development.js</code>  包内容包裹在另外一个 <code>process.env.NODE_ENV</code> 检查：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">!==</span> <span class="token string">"production"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// bundle code</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>这一方式，即使应用打包了开发版本和生产版本的文件，开发版本的文件在环境检查后将会是空。</p>
<p>额外的 <a href="https://en.wikipedia.org/wiki/Immediately-invoked_function_expression">IIFE</a> 包裹是有必要的，因为在 JavaScript 中 <code>if</code> 语句内部的一些声明（如函数）无法被替换。</p>
<h4 id="检测错误的无用代码擦除"><a href="#%E6%A3%80%E6%B5%8B%E9%94%99%E8%AF%AF%E7%9A%84%E6%97%A0%E7%94%A8%E4%BB%A3%E7%A0%81%E6%93%A6%E9%99%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>检测错误的无用代码擦除</h4>
<p>即使<a href="https://twitter.com/iamakulov/status/941336777188696066">环境变更</a>，许多流行的打包器目前仍无法强制用户指定是开发模式或生产模式。在这样的情况，<code>process.env.NODE_ENV</code> 通常由运行时的 polyfill 设置，但无用代码擦除检测并不会有效。</p>
<p>我们无法完全阻止 React 用户错误配置他们的打包器，但我们可以在 <a href="https://github.com/facebook/react-devtools">React DevTools</a> 里引入一些额外的检查。</p>
<p>若执行的是开发包，<a href="https://github.com/facebook/react/blob/d906de7f602df810c38aa622c83023228b047db6/packages/react-dom/src/client/ReactDOM.js#L1333-L1335">React DOM 会报告给 React 开发工具</a>：</p>
<br>

  <a class="gatsby-resp-image-link" href="/static/devtools-dev-e434ce2f7e64f63e597edf03f4465694-1e9b4.png" style="display: block" target="_blank" rel="noopener">
  
  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 600px; margin-left: auto; margin-right: auto;">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA7ElEQVQY05WQDWuDMBCG8///VQvCSIzxI9n8qEtiurmaqFFHwc3pUsZKYYyxh+N477gX7g68/x+tdSs593bgz9GPHyzLcn6dzoMFNGEQwiShaZr6GDNGaXIBQkQIYYwFJKRJjHEgxUHXqTOv6+rytm0gzwtVVZzzsiyLIldKHY9PnD9KIZ0uioMQQlXKDWRZJqvKNZ3W2lzMb78wz/OtuJZX3EXA8zy3XoD9OKToLnSBYRSFaUTu4/CBYLLf77DvI4QR8t0tUqjtG9Ca1lo7jmNnBtMMTW2bF3uqe6dPz33X2S+Mafu+n6bp9nOfEzOCGSCp8RoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;">
      <img class="gatsby-resp-image-image" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;" alt="React DevTools on a website with development version of React" title="" src="/static/devtools-dev-e434ce2f7e64f63e597edf03f4465694-1e9b4.png" srcset="/static/devtools-dev-e434ce2f7e64f63e597edf03f4465694-1cd08.png 210w,
/static/devtools-dev-e434ce2f7e64f63e597edf03f4465694-9b07a.png 420w,
/static/devtools-dev-e434ce2f7e64f63e597edf03f4465694-1e9b4.png 600w" sizes="(max-width: 600px) 100vw, 600px">
    </span>
  </span>
  
  </a>
    
<p>仍然有一些更糟糕的场景。有时，<code>process.env.NODE_ENV</code> 在运行时被设置为 <code>"production"</code> 而不是在构建时间。这在 Node.js 是正常的，但对于客户端构建来说则很糟糕，因为无用的开发代码也被打包进去了，即使其永远不会执行。这更难被检测到，但我们发现了在大多数情况下效果不错的一个试探性方法并且貌似不会产生误差。</p>
<p>我们可以写一个函数，仅在<a href="https://github.com/facebook/react/blob/d906de7f602df810c38aa622c83023228b047db6/packages/react-dom/npm/index.js#L11-L20">开发分支</a>下包含任意字符串。而后，若 <code>process.env.NODE_ENV</code> 被设置为 <code>"production"</code>，我们可以在<a href="https://github.com/facebook/react-devtools/blob/b370497ba6e873c63479408f11d784095523a630/backend/installGlobalHook.js#L143">那个函数里调用 <code>toString()</code></a>并去验证仅会在开发模式下才会被抛出的字符串。若仍然在这里，无用代码的擦除并不会生效，而且我们也需要警告开发者。由于开发可能不会注意到 React DevTool 在生产页面发出的警告。 我们也在 React DevTool 从 <a href="https://github.com/facebook/react-devtools/blob/b370497ba6e873c63479408f11d784095523a630/backend/installGlobalHook.js#L143"><code>setTimeout</code> 扔出一个错误</a>并希望能够被错误分析工具捕获。</p>
<p>我们意识到这方法有些脆弱。<code>toString()</code> 方法并不可靠并且可能在未来有些浏览器上会改变它的行为。这就是为什么我们将这些逻辑放到 React DevTool 里而不是 React 里。如果在之后出现了问题，这允许我们能移除它。我们也会发出警告仅当我们<em>发现</em>特别的字符串而不是我们<em>没</em>发现它。这一方式，如果 <code>toString()</code> 的输出变得不可测，或被重写，这一警告也不会触发。</p>
<h2 id="尽早捕获错误"><a href="#%E5%B0%BD%E6%97%A9%E6%8D%95%E8%8E%B7%E9%94%99%E8%AF%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>尽早捕获错误</h2>
<p>我们想要尽早地捕获错误。然而，即使扩展我们的测试覆盖率，我们偶尔还是会犯错误。今年我们在我们的构建和测试环节做了些调整以使其更难出错。</p>
<h3 id="迁移至-es-模块"><a href="#%E8%BF%81%E7%A7%BB%E8%87%B3-es-%E6%A8%A1%E5%9D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>迁移至 ES 模块</h3>
<p>通过 CommonsJS 的 <code>require()</code> 和 <code>module.exports</code>，其很容易引入一个实际上并不存在的函数，且直到你调用才会意识到。然而，若你输入错了一个引入的方法名称，类似 Rollup 这样原生支持 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import"><code>import</code></a> 和 <a href="https://developer.mozilla.org/en-US/docs/web/javascript/reference/statements/export"><code>export</code></a> 语法的工具将会构建失败。在 React 16 发布后，我们将整个 React 的源码调整成为了 ES 模块语法。</p>
<p>不仅提供了额外的保护，也缩小了构建包的体积。许多 React 模块仅暴露工具函数，但 CommonJS 强制要求我们将它们包装到对象里。通过将这些工具函数转换成命名的暴露并消除包装它们的对象，我们让 Rollup 将其放置在顶层作用于，这样能够让压缩器在生产版本压缩它们的名称。</p>
<p>目前，仅决定将源代码转换成 ES 模块，但不包括测试代码。我们使用类似 <code>jest.resetModules()</code> 这样强有力的工具并想要在测试中当模块初始化时能有更紧密的控制力。为了在测试中使用 ES 模块，我们支持了 <a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/jest/preprocessor.js#L28-L29">Babel CommonJS transform</a> 插件，但仅针对测试环境。</p>
<h3 id="在生产模式下运行测试"><a href="#%E5%9C%A8%E7%94%9F%E4%BA%A7%E6%A8%A1%E5%BC%8F%E4%B8%8B%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在生产模式下运行测试</h3>
<p>过去，我们在开发环境下运行所有测试。这让我们对 React 所产生的警告信息进行测试，并且貌似有一种普通的意义。然而，即使我们尝试在开发环境和生产环境上保持代码路径最小化的差异，但我们仍然会意外地在仅针对生产环境的代码上出现未被测试覆盖的错误，并且会产生一个 issues 在 Facebook 的 React 仓库上。x</p>
<p>为了解决这一问题，我们在CI（持续集成）上增减了运行所有 pull request 的 <a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/package.json#L110"><code>yarn test-prod</code></a> 的新命令，<a href="https://github.com/facebook/react/pull/11616">在生产环境下执行所有的测试用例</a>。我们将所有测试里任何有关警告信息的测试断言都包裹在开发模式的条件分支下，因此在两种环境下，他们仍然可以检测其预期行为。由于我们自定义了一个 通过<a href="/blog/2016/07/11/introducing-reacts-error-code-system.html">错误代码</a>来替换生产环境的错误信息的 Babel 转换插件，我们也加入了一个<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/jest/setupTests.js#L91-L126">逆向转换</a>作为生产环境测试运行的一部分。</p>
<h3 id="在测试环境下使用公共-api"><a href="#%E5%9C%A8%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E4%B8%8B%E4%BD%BF%E7%94%A8%E5%85%AC%E5%85%B1-api" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在测试环境下使用公共 API</h3>
<p>当我们<a href="https://code.facebook.com/posts/1716776591680069/react-16-a-look-inside-an-api-compatible-rewrite-of-our-frontend-ui-library/">重写 React reconciler</a>，我们意识到了对公共 API 而不是针对对内部模块编写测试的重要性。若针对公共 API 编写测试，其从用户视角来看什么需要被测试是非常清晰的，即使你完全从零开始重新实现，你也可以运行它。</p>
<p>我们到非常棒的 React 社区<a href="https://github.com/facebook/react/issues/11299">寻求帮助</a>将剩余的测试调整为测试公共 API。目前大部分的测试都已经被调整了。这一过程并不容易。有时一个单元测试仅调用一个内部方法，并且从用户地角度来看很难明确指出其期望测试的行为。我们找寻出了一些策略来解决这一问题。第一件事就是尝试从 git 的历史记录中找出该测试被添加的时间点，并从 issue 和 提交（pull request）的描述中发现一些线索。通常比原有的测试文件更有价值！一个很好验证猜测的方式是注释掉被测试的代码中某一行。若测试失败，我们便可以确定其在特定代码路径的重要性。</p>
<p>我们想要给<a href="https://github.com/facebook/react/issues?q=is%3Apr+11299+is%3Aclosed">每一位贡献过的伙伴</a>献上我们深深地感谢。</p>
<h3 id="对编译后的包运行测试"><a href="#%E5%AF%B9%E7%BC%96%E8%AF%91%E5%90%8E%E7%9A%84%E5%8C%85%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对编译后的包运行测试</h3>
<p>这也是对公共 API 编写测试的额外收益：现在我们可以<a href="https://github.com/facebook/react/pull/11633">对编译后的包运行测试</a>。</p>
<p>这帮助我们确保类似 Babel、Rollup 和 Google Closure Compiler 不会引人任何的 bug。这也为之后更为激进的优化方式打开了一扇门，只要我们能够确保 React 被优化之后能和之前预期的行为保持一致。</p>
<p>为了实现这一效果，我们创建了<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/jest/config.build.js">第二个 Jest 配置</a>。它重写我们默认的配置，把入口指向了 <code>react</code>、<code>react-dom</code>，并将其他入口指向 <code>/build/packages/</code> 文件夹。该文件夹并不包含任何 React 的源码，并反应了发布到 npm 上的内容。其在你运行 <code>yarn build</code> 之后生成。</p>
<p>这使得我们能够像我们通常在源代码运行的测试一样进行精准的测试，但使用开发环境和通过 Rollup 和 Google Closure Compiler 构建的生产环境的预发布的 React 包来执行。</p>
<p>不同于普通的测试，包测试依赖于构建产品，因此其无法很好的快速迭代。然而，其仍然能够通过在 CI 服务上运行，因此若出现崩溃，测试将会显示测试失败，我们也将会知道无法安全地将其合并到 master 分支上。</p>
<p>仍有一些测试文件我们故意没有在编译包上运行。有时我们想要模拟（mock）一个内部模块或重写一个目前不希望公开的特性标记。对于这些情况，我们通过将文件名从 <code>MyModule-test.js</code> 重命名为 <code>MyModule-test.internal.js</code> 来将其列入测试文件的黑名单。</p>
<p>目前，在 2,650 个 React 测试中有超过 93% 的测试是针对编译后的包。</p>
<h3 id="格式化编译后的包"><a href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E7%BC%96%E8%AF%91%E5%90%8E%E7%9A%84%E5%8C%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>格式化编译后的包</h3>
<p>除了格式化我们的源代码，我们在编译后的包上运行了更多一系列的格式化规则检查（实际上，<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/rollup/validate/eslintrc.cjs.js#L26-L27">仅有两个</a>）。这在底层工具上给了我们额外的保护防止引入异常并<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/rollup/validate/eslintrc.cjs.js#L22">确保</a>包没有使用更老的浏览器不支持的任何语言特性。</p>
<h3 id="模拟包发布"><a href="#%E6%A8%A1%E6%8B%9F%E5%8C%85%E5%8F%91%E5%B8%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模拟包发布</h3>
<p>甚至在构建后的包上运行测试也无法避免引入破坏的更新。例如，我们在我们的 <code>package.json</code> 文件中使用 <code>files</code> 字段来指向应该被发布到 npm 上的关于具体的文件夹和文件的白名单。然而，其很容易增加一个新的入口指向一个包但是忘记将其添加到白名单内。甚至包的测试已经通过，但在发布之后其入口则会丢失。</p>
<p>为了避免类似的情况，现在，在构建之后我们<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/rollup/packaging.js#L129-L134">通过运行 <code>npm pack</code> 和 快速解压</a>来模拟 npm 发布。类似 <code>npm publish</code>，这一命令过滤了任何不在 <code>files</code> 白名单内的任何东西。通过这一方式，若我们忘记添加一个入口到列表中，其将会在构建文件夹中缺失，而依赖于它的包测试将会失败。</p>
<h3 id="创建手动测试文件"><a href="#%E5%88%9B%E5%BB%BA%E6%89%8B%E5%8A%A8%E6%B5%8B%E8%AF%95%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建手动测试文件</h3>
<p>我们的单元测试仅在 Node 环境下运行，但不在浏览器环境下。这是有意而为之，因为在我们的经验中基于浏览器的测试工具非常奇怪，并且无法捕获许多问题。</p>
<p>我们可以摆脱这一问题，因为访问 DOM 的代码是固定的在少数几个文件中，并且通常不会改变。每周，我们将 Facebook.com 的 master 分支代码更新到 React 的最新提交。在 Facebook，对于重要的产品流程，我们使用了一系列内部的 <a href="http://www.seleniumhq.org/projects/webdriver/">WebDriver</a> 测试，并能够捕获一些异常。React 更新首先会被员工使用，因此紧急的 bug 会在它们到达 200 万的用户前被报告。</p>
<p>其仍然很难评审 DOM 相关的变更，而且我们偶尔也会犯错误。尤其是，很难记住所有代码必须要处理的边界条件，为什么要被添加，以及何时能将它们安全地移除。我们考虑增加些在浏览器上运行的自动化测试，但我们不想拖慢整个开发周期并处理一个脆弱的 CI 环境。自动化测试并不是永远都能捕获 DOM 异常。例如，一个显示在浏览器上的输入值可能和它所报告的 DOM 属性不匹配。</p>
<p>我们就这个问题和 <a href="https://github.com/aweary">Brandon Dail</a>、 <a href="https://github.com/jquense">Jason Quense</a> 以及 <a href="https://github.com/nhunzaker">Nathan Hunzaker</a> 进行了交谈。他们之前为 ReactDOM 提交了大量的补丁但很遗憾的是我们没有及时地进行审阅。我们决定给他们提交的权限，但要求他们对于类似输入管理的 DOM 相关的区域创建<a href="https://github.com/facebook/react/pull/8589">一系列的手工测试</a>。这一整套手动的测试文件在过去一年<a href="https://github.com/facebook/react/commits/master/fixtures/dom">不断增长</a>。</p>
<p>这些测试文件作为 React 应用的设施放在 <a href="https://github.com/facebook/react/tree/d906de7f602df810c38aa622c83023228b047db6/fixtures/dom"><code>fixtures/dom</code></a> 里。增加一个测试文件涉及编写一个代码有预期行为说明的 React 组件和相关问题及浏览器怪异行为（quirks）的链接，类似<a href="https://github.com/facebook/react/pull/11760">这个例子</a>：</p>
<img src="https://user-images.githubusercontent.com/590904/33555298-dd52fb4e-d8cd-11e7-80e9-8369538eb633.png" style="max-width:100%" alt="DOM fixture example">
<p>这个测试文件应用能够让你选择一个方便对比改变前后的 React 版本（本地或已发布到 npm 的版本）。当我们改变 DOM 交互的相关行为时，我们能够通过在不同的浏览器运行相关的测试文件验证其是否还存在问题。</p>
<p>在某些情况，一个改变复杂到需要一个单独的并基于此专门构建的测试文件来进行验证。例如，<a href="/blog/2017/09/08/dom-attributes-in-react-16.html">在 React 16 中处理 DOM 属性</a>很难在一开始就能自信地实现。我们尝试挖掘不同滴边界条件，并为 React 16 的及时发布几乎放弃了它。然而，我们构建了一份 用于在之前 React 版本和下一版本 React 渲染所有支持的属性和错误拼写的属性的<a href="https://github.com/facebook/react/tree/d906de7f602df810c38aa622c83023228b047db6/fixtures/attribute-behavior">“属性表测试文件（attribute table fixture）”</a> ，并显示两者的不同。其耗费了一些循环（关键的特性是将相似的行为组合到一起）但其最终能够让我们在几天时间内修复所有主要的问题。</p>
<br>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">We went through the table to vet the new behavior for every case (and discovered some old bugs too) <a href="https://t.co/cmF2qnK9Q9">pic.twitter.com/cmF2qnK9Q9</a></p>&mdash; Dan Abramov (@dan_abramov) <a href="https://twitter.com/dan_abramov/status/906244378066345984?ref_src=twsrc%5Etfw">September 8, 2017</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>运行测试文件仍然有大量的工作，我们考虑将其中一部分自动化。测试应用仍然是非常宝贵的，甚至是对 React 目前存在的行为和所有的边界条件以及浏览器 bug 的一个文档。使我们有信心在不破坏重要的用例的条件下对逻辑进行重大的调整。我们考虑的另外一个调整是增加一个 Github 机器人构建 并对每一次涉及相关文件的提交自动地部署测试文件，因此每个人都可以进行浏览器测试。</p>
<h3 id="预防死循环"><a href="#%E9%A2%84%E9%98%B2%E6%AD%BB%E5%BE%AA%E7%8E%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>预防死循环</h3>
<p>React 16 代码包含了大量的 <code>while</code> 循环。它们让我们避免发生在早期 React 版本的可怕的过深的调用栈路径，但使得 React 开发变得非常难。每次退出条件出现错误时我们的测试将会被挂起，并花费一些时间来找出哪个循环引发了这一问题。</p>
<p>受到 <a href="https://repl.it/site/blog/infinite-loops">Repl.it 所采用策略的</a> 启发，我们在测试环境增加了一个<a href="https://github.com/facebook/react/blob/d906de7f602df810c38aa622c83023228b047db6/scripts/babel/transform-prevent-infinite-loops.js">防止死循环的 Babel 插件</a>。若某些循环超过了循环允许的最大数值，我们将会抛出一个错误并立刻失效以让 Jest 能够准确地显示确切的发生位置。</p>
<p>这一方式有一个缺陷。若一个错误从 Babel 插件中产生并忽略函数调用栈，测试将会通过即使是死循环。这真的、真的非常糟糕。为解决这一问题，我们在抛出错误之前<a href="https://github.com/facebook/react/blob/d906de7f602df810c38aa622c83023228b047db6/scripts/jest/setupTests.js#L42-L56">设置了一个全局区域</a>。而后，在每次测试运行之后，如果全局区域已经被设置了我们将重新爆出错误。这一方式下任何死循环将会造成测试失败，无论错误是否是由 Babel 插件引起。</p>
<h2 id="自定义构建"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自定义构建</h2>
<p>在引入新的构建流程后，仍然有一些东西我们必须进行微调。其花费了我们一些时间来处理，但我们对于我们所能找到的解决方案表示满意。</p>
<h3 id="消除无用代码"><a href="#%E6%B6%88%E9%99%A4%E6%97%A0%E7%94%A8%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消除无用代码</h3>
<p>Rollup 和 Google Closure Compiler 的结合已经能够让我们在生产包中仅将开发的代码剥离。我们在构建期间将 <code>__DEV__</code> 字符串<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/rollup/build.js#L223-L226">替换</a>为一个布尔类型的常量，Rollup 和 Google Closure Compiler 都能够将 <code>if (false) {}</code> 的代码分支以及一些更复杂的模式给移除。然而，仍然存在一个非常讨厌的情况：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token keyword">import</span> warning <span class="token keyword">from</span> <span class="token string">'fbjs/lib/warning'</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">warning</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">'Blimey!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>这一模式在 React 源码中非常常见。然而 <code>fbjs/lib/warning</code> 是一个外部引入的库，而不是 Rollup 打包的 CommonJS 包。因此，即使 <code>warning()</code> 完全被移除，Rollup 仍然不知道能否安全地移除整个引入。要是模块在初始化期间有副作用？那移除操作将会变得不安全。</p>
<p>为解决这一问题，我们使用了 <a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/rollup/build.js#L338-L340">Rollup 的 <code>treeshake.pureExternalModules</code> 选项</a>，将确保不会产生副作用的模块保存在一个数组里。这能够让 Rollup 知道如果 <code>fbjs/lib/warning</code> 引入未被使用，能够完全安全地将它从代码中剥离。然而， 如果它<em>正在</em>被使用（例如我们决定在生产版本中增加警告），import 则将会被保留。这就是为什么这一方式比替换成空模块更为安全。</p>
<p>当我们进行某些优化，我们需要确保其不会在之后引入 bug。要是某人引入了一个新的仅在开发模式下可用的额外的库，并且未意识也到需要添加到 <code>pureExternalModules</code> 里？Rollup 在这样的情况会打印出一个警告，但我们<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/rollup/build.js#L395-L412">决定让整个构建环节都失效</a>。这强制人们每次增加一个仅在开发模式下可用的包就需要直接地声明<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/rollup/modules.js#L10-L22">而无论其是否具有副作用</a> 。</p>
<h3 id="fork-模块"><a href="#fork-%E6%A8%A1%E5%9D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fork 模块</h3>
<p>在某些情况，不同的包需要包含些稍微不同的代码。例如，React Native 有不同的错误处理机制，即展示一个红框而不是打印一条信息到控制台。然而，通过模块调用将差异串联起来非常地不方便。</p>
<p>类似这样的问题通常通过运行时配置进行解决。然而，有时候则无法处理：例如，React DOM 包甚至不应该去引入 React Native 的 redbox 函数。将从未在指定环境运行下使用的代码进行打包也是非常糟糕的。</p>
<p>另一种方式是使用动态依赖注入。然而，这通常会使得代码难以理解并可能造成严重的依赖。这也使得一些优化的机会落空。</p>
<p>从代码的角度来看，理想情况下我们仅希望将不同的模块重新指向特定的包。这一 “fork” 和原来的模块一样有相同的 API，但处理的方式不同。我们发现这一模型非常直观，并<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/rollup/forks.js">创建了一个 fork 配置文件</a> 来对如何与他们原始的模块进行映射以及在哪些条件下会发生进行详细说明。</p>
<p>例如，fork 配置入口对于不同的包指定了不同的 <a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/packages/shared/ReactFeatureFlags.js">特性标志</a>：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token string">'shared/ReactFeatureFlags'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>bundleType<span class="token punctuation">,</span> entry<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>entry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'react-native-renderer'</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token string">'shared/forks/ReactFeatureFlags.native.js'</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'react-cs-renderer'</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token string">'shared/forks/ReactFeatureFlags.native-cs.js'</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>bundleType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> FB_DEV<span class="token punctuation">:</span>
        <span class="token keyword">case</span> FB_PROD<span class="token punctuation">:</span>
          <span class="token keyword">return</span> <span class="token string">'shared/forks/ReactFeatureFlags.www.js'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
      </div>
<p>在构建期间，若条件满足，<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/scripts/rollup/plugins/use-forks-plugin.js#L40">我们自定义的 Rollup 插件</a>将会用它们 fork 的模块来替换。由于原始模块和 fork 的模块都由 ES 模块写成， Rollup 和 Google Closure Compiler 可以内嵌（inline）类似数字或布尔值等常量，并因此对于不支持的特性标志能够有效地移除。在测试中，当需要时，我们<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/packages/react-cs-renderer/src/__tests__/ReactNativeCS-test.internal.js#L15-L17">使用 <code>jest.mock()</code></a> 指向指向特定的 fork 版本。</p>
<p>作为回报，我们可能想要验证原始模块的导出类型和 fork 模块的导出类型是否完全匹配。我们可以使用一个<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/packages/shared/forks/ReactFeatureFlags.native.js#L32-L36">有些奇怪但完全能够正常运转的 Flow 技巧</a>来实现：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token keyword">import</span> <span class="token keyword">typeof</span> <span class="token operator">*</span> <span class="token keyword">as</span> FeatureFlagsType <span class="token keyword">from</span> <span class="token string">'shared/ReactFeatureFlags'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">typeof</span> <span class="token operator">*</span> <span class="token keyword">as</span> FeatureFlagsShimType <span class="token keyword">from</span> <span class="token string">'./ReactFeatureFlags.native'</span><span class="token punctuation">;</span>
type Check<span class="token operator">&lt;</span>_X<span class="token punctuation">,</span> Y<span class="token punctuation">:</span> _X<span class="token punctuation">,</span> X<span class="token punctuation">:</span> Y <span class="token operator">=</span> _X<span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">:</span> Check<span class="token operator">&lt;</span>FeatureFlagsShimType<span class="token punctuation">,</span> FeatureFlagsType<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<p>这一方式通过强制 Flow 去验证两个模块是否能互相赋值（因此是相等的）。现在，如果我们在不改变其他文件的情况下修改原始模块或 fork 模块的导出，类型检查将会失败。这可能有点愚蠢，但我们发现在实践中非常有帮助。</p>
<p>概括一下这一章，注意如果你在 npm 上来使用 React 则无法指定你自己的 fork 模块。这是有意的，因为这些文件中没有公开的 API，而且它们并没有被 <a href="https://semver.org/">semver</a> 所覆盖。然而，如果你不介意不稳定性和差异性风险，我们欢迎你从 master 分支上来构建 React 甚至是 fork 它。我们希望这篇文章对于记录从单个 JavaScript 库角度出发定位于不同的环境能提供帮助。</p>
<h3 id="追踪包尺寸"><a href="#%E8%BF%BD%E8%B8%AA%E5%8C%85%E5%B0%BA%E5%AF%B8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>追踪包尺寸</h3>
<p>作为构建的最后一步，我们现在<a href="https://github.com/facebook/react/blob/d906de7f602df810c38aa622c83023228b047db6/scripts/rollup/build.js#L264-L272">记录所有构建包的构建大小</a>并将它们写入到一个<a href="https://github.com/facebook/react/blob/d906de7f602df810c38aa622c83023228b047db6/scripts/rollup/results.json">类似这样</a>的文件里。当运行 <code>yarn build</code>，其会打印一个结果的表格：</p>
<br>
<img src="https://user-images.githubusercontent.com/1519870/28427900-80487dbc-6d6f-11e7-828d-1b594bd1ddb5.png" style="max-width:100%" alt="Build results after running GCC">
<p><em>（其并不是一直都这样好。这次提交是将 React 从 Uglify 迁移到 Google Closure Compiler。）</em></p>
<p>记录文件大小对于每个人追踪包尺寸变化和激励着去发现优化的机会都十分有帮助。</p>
<p>我们对这一策略并不完全满意，因为 JSON 文件通常会在更大的分支中造成合并冲突。当前并不是强制进行更新，因此其可能会过时。之后，我们考虑将其集成到自动化中，在每次的提交中都会带有文件大小的变化。</p>
<h2 id="简化发布换件"><a href="#%E7%AE%80%E5%8C%96%E5%8F%91%E5%B8%83%E6%8D%A2%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简化发布换件</h2>
<p>我们经常喜欢向开源社区发布更新。不幸的是，旧的流程在处理发布时非常的慢且通常会耗费一整天。在对这一流程做了些改变后，我们现在能够在一个小时内完成整个发布。这就是我们所做的调整。</p>
<h3 id="分支策略"><a href="#%E5%88%86%E6%94%AF%E7%AD%96%E7%95%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分支策略</h3>
<p>由于我们的分支策略，在旧的发布流程中消耗了大多数的时间。<code>master</code> 分支被认为不可靠的且通常会包含一些破坏性的更新。发布通常从一个稳定分支完成，且更新需要在发布前手动低将其挑选到这一分支中去。我们有<a href="https://github.com/facebook/react/pull/7330">工具来帮助自动化</a>其中一些流程，但使用仍然<a href="https://github.com/facebook/react/blob/b5a2a1349d6e804d534f673612357c0be7e1d701/scripts/release-manager/Readme.md">相当复杂</a>。</p>
<p>随 16 版本，我们现在从 <code>master</code> 分支上进行发布。实验特性和一些破坏性更新也被允许，但必须隐藏在<a href="https://github.com/facebook/react/blob/cc52e06b490e0dc2482b345aa5d0d65fae931095/packages/shared/ReactFeatureFlags.js">特性标记</a>之后，所以他们能够在构建环节被移除。新的扁平化包和无用代码擦除使得我们不用担心将任何不想公开的代码泄露到开源版本中。</p>
<h3 id="自动化脚本"><a href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自动化脚本</h3>
<p>将变更迁入到稳定的 <code>master</code> 后，我们创建了一个新的 <a href="https://github.com/facebook/react/issues/10620">发布流程清单</a>。尽管比之前的环节更简单，这仍然包含了大量的步骤且遗忘了一个可能会导致一次异常的发布。</p>
<p>为解决这一问题，我们创建了一个新的 <a href="https://github.com/facebook/react/pull/11223">自动地发布流程</a>，其<a href="https://github.com/facebook/react/tree/master/scripts/release#react-release-script">更容易使用</a>并包含了几项构建检查以确保我们发布了一次有效的构建。新的流程被分隔为两步：<em>构建</em> 和 <em>发布</em>。这是你第一次运行的样子：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/release-script-build-overview-adca79c3a0e003b317fe62e68ce9d4a0-a0a5f.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 822px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 45.37712895377128%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAAA4ElEQVQoz52S227DIAyGU3JogRAICQdpKR2EoVzk/Z9vf9ObXkxbtE/IsrCwf9tU8zxbY8dx1FpLKWfn4ZvZjErVdV39zk0banz/8YDD/XJV+kJIdZL6RknTdkK2/YDTUF6dh3NurRPDAP3qoOu6s49DeHDGqv9hjMk5L8sdNZGolLLv+7Zta0oxxs8YU0pSKmvtD4/zmr3zPeD8esAYo5T+PWrQtt1rT+j5ckAIgUUIVgiBEKxzrmma1/3bqijNeYXgEAJ0QohS2LFCRtSfpincEQnlqzx7WROmqw/wKb4BarITYyj4QEYAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Release Script overview"
        title=""
        src="/static/release-script-build-overview-adca79c3a0e003b317fe62e68ce9d4a0-a0a5f.png"
        srcset="/static/release-script-build-overview-adca79c3a0e003b317fe62e68ce9d4a0-d0a04.png 210w,
/static/release-script-build-overview-adca79c3a0e003b317fe62e68ce9d4a0-c8d6c.png 420w,
/static/release-script-build-overview-adca79c3a0e003b317fe62e68ce9d4a0-a0a5f.png 822w"
        sizes="(max-width: 822px) 100vw, 822px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p><em>构建</em> 环节做了大量的工作 - 验证许可，运行测试和检查 CI 状态。一旦其完成，其将会输出一个梯形清单到 CHANGELOG 并使用之前提到的 <a href="#creating-manual-test-fixtures">手工装置</a> 来进行包验证。</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/release-script-build-confirmation-17f44f353d82a22f6a18707956ad065f-d15b8.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 840px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 95.52407932011332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsSAAALEgHS3X78AAABlUlEQVQ4y5VTa2+sIBRc9yWKgjwVFMXV5qbJ7f//ex0xt19u624nhiA5E+bMGU7KKN/7GM00mbbr2raVUlJK67ouyzLPc5KT+/1++hbam8eyrOsaQgDh9CsII/phGELo+15pfT6ff0FWnR7HEXTOOaUVYwxqq6q6Xq+vkud51loLIfZWQX5Jwia7H5xz1racN2AWRYH7wadVBcOOyLWo4bC11rlGSl4mgLmvt9vtiFzokkiSizzLMvxmCWlz/tr/CPiEa7sEmyQYY9E/zpumYYwfNY88oEOealnC7hlJeGJbnoA6rCWlO2c/wbSeyIZOhMR5h2l57ykt85/C+D/QGMarE1JO6OVyyf5htxAr9H+jApGOcca6LMuw7SMkqARjjJRWyEGpKMQg5ESIIoXGR6u+KM0JRbvVKEVIX0rlF2Bv16kQxPIw62qVItYWUhLGCDxHF0dktOp9H6N/e3N/P6b39xXi8Uhh3pNsAnj6xgalg22Xzv2x7cOYeevnFSDS46hi1NO0+T3AF8mM4dvDwNwoPbj/E0RsJqoTdg3PAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Release Script build confirmation screen"
        title=""
        src="/static/release-script-build-confirmation-17f44f353d82a22f6a18707956ad065f-acf85.png"
        srcset="/static/release-script-build-confirmation-17f44f353d82a22f6a18707956ad065f-c1418.png 210w,
/static/release-script-build-confirmation-17f44f353d82a22f6a18707956ad065f-5d5d8.png 420w,
/static/release-script-build-confirmation-17f44f353d82a22f6a18707956ad065f-acf85.png 840w,
/static/release-script-build-confirmation-17f44f353d82a22f6a18707956ad065f-de0cd.png 1260w,
/static/release-script-build-confirmation-17f44f353d82a22f6a18707956ad065f-bd6c2.png 1680w,
/static/release-script-build-confirmation-17f44f353d82a22f6a18707956ad065f-d15b8.png 1765w"
        sizes="(max-width: 840px) 100vw, 840px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>剩下的就是进行标记（tag）并使用<em>发布</em>脚本发布到 NPM 上。</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/release-script-publish-confirmation-a3846d4b3e50d29415846b58612310f2-bd35c.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 840px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 125.12733446519523%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAAsSAAALEgHS3X78AAACY0lEQVQ4y5WUaY+bMBCG06RJANtAgMQGmyOQa4+q+6X9/z+tj6GHEu1q6SuExsdc78x4cTCHY98fj33bNsCB2v/SNM2yjH8OCg+lZBAEaeKxWi05WshMcr2qKmOMNuagtVJqtVot5mArtrvdLsvzldgvVBXKBE+LmRC1jCrBJxsZFMHivzDlRlo4JOx0tyOlOI7zLGefVMdlIqWsbEWM6/X6nzL3uBSGIQdRFG2327kJA3T2+z0msI2MfynVyIIPR2vjN4sCu8vl8lEZbok8igTOkbHCvUkAuyybZExzgaMvD8rYFkJwwiUyjLzgFRJf5CJWik01GqXOd56xJ4RPdbPZhGHAchTCyc9fh8EIhDvCSHKiN0nSZPRGIJDsd+L4E8JOpxO9NZw8Xl5eaNXb09NjeB+BeyQ2OSQEDIVhJlWt4pZPxg3/JD2xI2Sl4k4qF0aHP6XKsuv1ej6fn56f69oNw6lp28vl0g/dzx/1+ZxoHX7oGbats34wSqbi4Gp9uRRNI/M8oPy0gNaRMVFRBEJIQqOjpJK/leGWXSidOpHbMD+3w+CpNOb19Vvvp/rIchiGrutIhOVdYd4NuyxLP/6uGAbT92XdDNo4Uz4naTfRNlLF324298Wjnngg5uPRXa+dcwdr8763TVOTy5xS5WoECftAqtJaOzvnshwz7JF5xm6321zC6FxtNDwz+23baq2xhQlog8JpvAEBfl2vH0edlm67DgU0v7+94ZyYaXQqX46ASescnVdZi+k7ZZ5O5hknJOzqGvLomblhM3QQNj5j+fSSwBkvmn+d03R6EhDf7Zxfl+pFob7eDqUAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Release Script publish confirmation screen"
        title=""
        src="/static/release-script-publish-confirmation-a3846d4b3e50d29415846b58612310f2-acf85.png"
        srcset="/static/release-script-publish-confirmation-a3846d4b3e50d29415846b58612310f2-c1418.png 210w,
/static/release-script-publish-confirmation-a3846d4b3e50d29415846b58612310f2-5d5d8.png 420w,
/static/release-script-publish-confirmation-a3846d4b3e50d29415846b58612310f2-acf85.png 840w,
/static/release-script-publish-confirmation-a3846d4b3e50d29415846b58612310f2-bd35c.png 1178w"
        sizes="(max-width: 840px) 100vw, 840px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>（你可能在之前的截图中注意到了 <code>--dry</code> 标记。该标记允许我们运行一次端到端的发布，而不会实际发布到 NPM。这对于处理发布脚本自身时非常有用。）</p>
<h2 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h2>
<p>这篇博客是否激励你让你在你自己的项目中尝试一些想法？我们确实希望如此。若你有其他关于如何构建 React，测试，或贡献工作流的提升，请在[我们的问题追踪器]上让我们知道(<a href="https://github.com/facebook/react/issues">https://github.com/facebook/react/issues</a>)。</p>
<p>你可以通过<a href="https://github.com/facebook/react/labels/Component%3A%20Build%20Infrastructure">构建基础设施标签</a> 找到相关问题。这些通常是第一次贡献的好机会！</p>
<h2 id="感谢"><a href="#%E6%84%9F%E8%B0%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>感谢</h2>
<p>我们想要感谢：</p>
<ul>
<li><a href="https://github.com/Rich-Harris">Rich Harris</a> 和 <a href="https://github.com/lukastaegert">Lukas Taegert</a> 对于 Rollup 的为何以及帮助我们迁移到那。</li>
<li><a href="https://github.com/dimvar">Dimitris Vardoulakis</a>， <a href="https://github.com/ChadKillingsworth">Chad Killingsworth</a> 和 <a href="https://github.com/MatrixFrog">Tyler Breisacher</a> 对于他们在 Google Closure Compilre 上的工作以及及时的建议。</li>
<li><a href="https://github.com/watadarkstar">Adrian Carolli</a>，<a href="https://github.com/rivenhk">Adams Au</a>，<a href="https://github.com/accordeiro">Alex Cordeiro</a>, <a href="https://github.com/HeroProtagonist">Jordan Tepper</a>，<a href="https://github.com/sjy">Johnson</a>，<a href="https://github.com/misoguy">Soo Jae Hwang</a>，<a href="https://github.com/xjlim">Joe Lim</a>，<a href="https://github.com/yu-tian113">Yu Tian</a> 和其他人帮助在原型和实现中所做的相关的改进。</li>
<li><a href="https://github.com/anushreesubramani">Anushree Subramani</a>，<a href="https://github.com/abiduzz420">Abid Uzair</a>，<a href="https://github.com/skiritsis">Sotiris Kiritsis</a>，<a href="https://github.com/timjacobi">Tim Jacobi</a>, <a href="https://github.com/aarboleda1">Anton Arboleda</a>，<a href="https://github.com/jeremenichelli">Jeremias Menichelli</a>，<a href="https://github.com/audyodi">Audy Tanudjaja</a>，<a href="https://github.com/gordyd">Gordon Dent</a>, <a href="https://github.com/enapupe">Iacami Gevaerd
</a>，<a href="https://github.com/sadpandabear">Lucas Lentz</a>, <a href="https://github.com/silvestrijonathan">Jonathan Silvestri</a>，<a href="https://github.com/mjw56">Mike Wilcox</a>，<a href="https://github.com/smaniotto">Bernardo Smaniotto</a>，<a href="https://github.com/douglasgimli">Douglas Gimli</a>，<a href="https://github.com/ethan-arrowood">Ethan Arrowood</a>，以及其他人来帮助完成移植 React 测试套件使用公共的 API。</li>
</ul>]]></description><link>https://doc.react-china.org/blog/2017/12/15/improving-the-repository-infrastructure.html</link><guid isPermaLink="false">https://doc.react-china.org/blog/2017/12/15/improving-the-repository-infrastructure.html</guid><pubDate>Fri, 15 Dec 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Introducing the React RFC Process]]></title><description><![CDATA[<p>我们正在采用一个 RFC（“征求意见（request for comments）”）  的流程为 React 提供意见。</p>
<p>受到  <a href="https://github.com/yarnpkg/rfcs">Yarn</a>、 <a href="https://github.com/emberjs/rfcs">Ember</a> 和 <a href="https://github.com/rust-lang/rfcs">Rust</a> 社区的激励，目标是能够让 React 核心团队成员和社区成员共同来设计新特性。这也是打算为参加这一项目的成员提供一个明确的路径：</p>
<ul>
<li>创建一个 RFC 文档详细描述你的建议。</li>
<li>提交一个 PR 到 <a href="https://github.com/reactjs/rfcs">RFC 仓库</a>。</li>
<li>将反馈合并到提案中。</li>
<li>在经过讨论之后，核心团队可能会或可能不会采纳该 RFC。</li>
<li>若该 RFC 被采纳，则 PR 会被合并。</li>
</ul>
<p>当 RFC 被同意在 React 中实现时则会被采纳。关于这一流程更为全面的描述可以查看该仓库的 <a href="https://github.com/reactjs/rfcs/blob/master/README.md">README</a>。具体细节可能会在之后有所改善。</p>
<h2 id="谁能提交-rfc？"><a href="#%E8%B0%81%E8%83%BD%E6%8F%90%E4%BA%A4-rfc%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>谁能提交 RFC？</h2>
<p>任何人！没有必须要求了解 React 的内部机制，也不期望你自己来实现这个提案。</p>
<p>和我们其他的仓库一样，我们会在接受你的 PR 前要求你完成<a href="https://github.com/reactjs/rfcs#contributor-license-agreement-cla">贡献者许可协议（Contributor License Agreement）</a>。</p>
<h2 id="什么类型的改变应作为-rfc-提交"><a href="#%E4%BB%80%E4%B9%88%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%94%B9%E5%8F%98%E5%BA%94%E4%BD%9C%E4%B8%BA-rfc-%E6%8F%90%E4%BA%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>什么类型的改变应作为 RFC 提交?</h2>
<p>通常来讲，在实现前任何额外的评审或设计对于 RFC 来说都是不错的选择。根据过往经验，这意味着任何增加、改变，或移除一个 React API 类型的提案都可以。</p>
<p>并不是每个变更都必须经过 RFC 的流程。Bug 修复或性能提升等不会修改 API 的提案将会直接被提交到主代码库中。</p>
<p>我们现在有几个你可以参与为 React 贡献的仓库：</p>
<ul>
<li><strong>问题，bug 修复和代码变更提交到主仓库</strong> : <a href="https://github.com/facebook/react">facebook/react</a></li>
<li><strong>官网及文档</strong>：<a href="https://github.com/reactjs/reactjs.org">reactjs/reactjs.org</a></li>
<li><strong>需要在实现前进行额外评审的想法</strong>：<a href="https://github.com/reactjs/rfcs">reactjs/rfcs</a></li>
</ul>
<h2 id="关于新-api-的-rfc"><a href="#%E5%85%B3%E4%BA%8E%E6%96%B0-api-%E7%9A%84-rfc" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于新 API 的 RFC</h2>
<p>结合我们刚发布的 RFC 流程，我们已经提交了一份<a href="https://github.com/reactjs/rfcs/pull/2">关于新版本背景的提案</a>。该提案已受到了许多来自社区的有价值的反馈，我们已将这些意见采纳到新设计的 API 中。</p>
<p>该提案是一个如何组织 RFC 的好例子。我们期待收到你的提案！</p>]]></description><link>https://doc.react-china.org/blog/2017/12/07/introducing-the-react-rfc-process.html</link><guid isPermaLink="false">https://doc.react-china.org/blog/2017/12/07/introducing-the-react-rfc-process.html</guid><pubDate>Thu, 07 Dec 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[React v16.2.0: Improved Support for Fragments]]></title><description><![CDATA[<p>React 16.2 现在已经发布了！最大的增加是提高了对子组件的渲染方法返回多个子元素的支持。我们称这一特性称为 <em>fragments</em>：</p>
<p>Fragment 看起来像是空的 JSX 标签。他们能够让 let you group a list of children 而无需添加额外的节点到 DOM 树上：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildA</span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildB</span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildC</span> <span class="token punctuation">/></span></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>这一令人激动的新特性能够通过 React 和 JSX 添加来实现。</p>
<h2 id="什么是-fragments？"><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-fragments%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>什么是 Fragments？</h2>
<p>对于一个组件来说，普遍模式是返回一个列表的子组件。用 HTML 展示这个例子的如下：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-html"><code>Some text.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>A heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
More text.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Another heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
Even more text.
</code></pre>
      </div>
<p>React 16 之前的版本，React 实现这一功能的唯一方式是通过用一个额外的元素来包装子节点，通常使用一个 <code>div</code> 或 <code>span</code>：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// Extraneous div element :(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
      Some text<span class="token punctuation">.</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>A heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
      More text<span class="token punctuation">.</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Another heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
      Even more text<span class="token punctuation">.</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>为了处理这一限制，React 16.0 增加了对<a href="https://reactjs.org/blog/2017/09/26/react-v16.0.html#new-render-return-types-fragments-and-strings">组件的 <code>render</code> 方法返回一个包含元素的数组</a> 的支持。你可以将其他们放进数组里，而不用将子元素包装在一个 DOM 元素内：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token punctuation">[</span>
  <span class="token string">"Some text."</span><span class="token punctuation">,</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>heading-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>A heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  <span class="token string">"More text."</span><span class="token punctuation">,</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>heading-2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Another heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  <span class="token string">"Even more text."</span>
 <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>然而，这和普通 JSX 有一些令人混淆的区别：</p>
<ul>
<li>数组中的子元素必须用逗号分隔，</li>
<li>数组中的子元素必须有一个唯一的 key 以防止 React 的 <a href="https://reactjs.org/docs/lists-and-keys.html#keys">key 警告</a>。</li>
<li>字符串必须包括在引号内。</li>
</ul>
<p>为了对 fragment 提供更好的一致性开发体验，React 现在提供了第一等的 <code>Fragment</code>组件以可以用来替换数组。</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Fragment</span><span class="token punctuation">></span></span>
</span>      Some text<span class="token punctuation">.</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>A heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
      More text<span class="token punctuation">.</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Another heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
      Even more text<span class="token punctuation">.</span>
<span class="gatsby-highlight-code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Fragment</span><span class="token punctuation">></span></span>
</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>你可以像使用其他任何元素一样使用 <code>&#x3C;Fragment /></code>，而不用改变你写 JSX 的方式。没有逗号，没有 key，没有引号。</p>
<p>Fragment 能够通过 React 对象进行使用：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token keyword">const</span> Fragment <span class="token operator">=</span> React<span class="token punctuation">.</span>Fragment<span class="token punctuation">;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Fragment</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildA</span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildB</span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildC</span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Fragment</span><span class="token punctuation">></span></span>

<span class="token comment">// This also works</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>React.Fragment</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildA</span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildB</span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildC</span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>React.Fragment</span><span class="token punctuation">></span></span>
</code></pre>
      </div>
<h2 id="jsx-fragment-语法"><a href="#jsx-fragment-%E8%AF%AD%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JSX Fragment 语法</h2>
<p>在 Facebook, 片段（Fragments）在我们的代码库中是一个通用模式。我们期望也能被其他团队广泛采用。为了保证开发体验尽可能地便利，我们为 JSX 增加了 fragment 的语法支持：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token operator">&lt;</span><span class="token operator">></span>
</span>      Some text<span class="token punctuation">.</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>A heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
      More text<span class="token punctuation">.</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Another heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
      Even more text<span class="token punctuation">.</span>
<span class="gatsby-highlight-code-line">    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>React 中，类似于之前一节展示的例子，是 <code>&#x3C;React.Fragment /></code> 的语法糖。（使用 JSX 的非 React 框架可能在编译时有些差异。）</p>
<p>JSX 里的 Fragments 语法受到了来自之前技术如 <a href="https://developer.mozilla.org/en-US/docs/Archive/Web/E4X/E4X_for_templating">E4X</a> 中的 <code>XMLList() &#x3C;>&#x3C;/></code> 构造函数的激励。使用一对空标签其意味不用添加了一个实际的元素到 DOM 结构中。</p>
<h3 id="带有-key-属性的-fragments"><a href="#%E5%B8%A6%E6%9C%89-key-%E5%B1%9E%E6%80%A7%E7%9A%84-fragments" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>带有 key 属性的 Fragments</h3>
<p>注意 <code>&#x3C;>&#x3C;/></code> 语法不接受属性，包括 key。</p>
<p>若你需要一个带有 key 属性的 fragment，你可以直接使用 <code>&#x3C;Fragment /></code>。一个例子是将一个集合映射到一个片段的数组 — 例如，创建一个列表：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token keyword">function</span> <span class="token function">Glossary</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dl</span><span class="token punctuation">></span></span>
      <span class="token punctuation">{</span>props<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=></span> <span class="token punctuation">(</span>
        <span class="token comment">// Without the `key`, React will fire a key warning</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Fragment</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>term<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>description<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Fragment</span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dl</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p><code>key</code> 是唯一一个能够传递给 <code>Fragment</code>  的属性。未来，我们可能还会增加额外属性，如事件处理。</p>
<h3 id="在线演示"><a href="#%E5%9C%A8%E7%BA%BF%E6%BC%94%E7%A4%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在线演示</h3>
<p>你可以在 <a href="https://codepen.io/reactjs/pen/VrEbjE?editors=1000">CodePen</a> 体验 JSX fragment。</p>
<h2 id="fragment-语法支持"><a href="#fragment-%E8%AF%AD%E6%B3%95%E6%94%AF%E6%8C%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fragment 语法支持</h2>
<p>在 JSX 支持 fragment 语法将取决你用于构建应用的工具。请对 JSX 社区致力于采用新语法保持些耐心。我们也在和大多数流行项目的维护者紧密的合作:</p>
<h3 id="create-react-app"><a href="#create-react-app" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create React App</h3>
<p>试验性支持的 fragment 语法将会在接下来几天中加入到 Create React App。稳定版的发布可能需要更长的时间，由于我们需要等到上游项目的采纳。</p>
<h3 id="babel"><a href="#babel" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Babel</h3>
<p>对于 JSX fragment 已经在 <a href="https://github.com/babel/babel/releases/tag/v7.0.0-beta.31">Babel v7.0.0-beta.31</a> 及以上版本中得到支持！若你已经在使用 Babel 7，很容易将其升级到最新版本的 Babel 和 transform 插件（plugin transform）:</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-bash"><code><span class="token comment"># for yarn users</span>
yarn upgrade @babel/core @babel/plugin-transform-react-jsx
<span class="token comment"># for npm users</span>
<span class="token function">npm</span> update @babel/core @babel/plugin-transform-react-jsx
</code></pre>
      </div>
<p>或若你正在使用 <a href="https://www.npmjs.com/package/@babel/preset-react">react preset</a>：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-bash"><code><span class="token comment"># for yarn users</span>
yarn upgrade @babel/core @babel/preset-react
<span class="token comment"># for npm users</span>
<span class="token function">npm</span> update @babel/core @babel/preset-react
</code></pre>
      </div>
<p>注意 Babel 7 目前技术上仍在 beta 阶段，但<a href="https://babeljs.io/blog/2017/09/12/planning-for-7.0">稳定版本将很快发布</a>。 </p>
<p>不幸的是，目前仍然还没有对 Babel 6.x 进行支持，同时目前也没有计划反向移植到旧版中。</p>
<h4 id="babel-以及-webpack-babel-loader"><a href="#babel-%E4%BB%A5%E5%8F%8A-webpack-babel-loader" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Babel 以及 Webpack (babel-loader)</h4>
<p>如果你在使用 Babel 和 <a href="https://webpack.js.org/">Webpack</a>，则不需要额外的步骤，因为 <a href="https://github.com/babel/babel-loader">babel-loader</a> 将会使用你的同等安装的 Babel 版本。</p>
<h4 id="babel-及其他框架"><a href="#babel-%E5%8F%8A%E5%85%B6%E4%BB%96%E6%A1%86%E6%9E%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Babel 及其他框架</h4>
<p>如果你在使用 JSX 及非 React 框架如 Inferno 或 Preact，在 <a href="https://github.com/babel/babel/tree/master/packages/babel-plugin-transform-react-jsx#pragmafrag">babel-plugin-transform-react-jsx 中有一个编译选项</a> 能够配置 Babel 编译器使其能够将 <code>&#x3C;>&#x3C;/></code> 这一语法糖编译为一个自定义标签。</p>
<h3 id="typescript"><a href="#typescript" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TypeScript</h3>
<p>TypeScript 已经完全支持 fragment 语法！请升级到 <a href="https://github.com/Microsoft/TypeScript/releases/tag/v2.6.2">2.6.2 版本</a>。（注意这非常重要，即使你已经升级到了 2.6.1 版本，由于这一支持是作为补丁发布在 2.6.2 上的。）</p>
<p>使用如下命令升级到最新版本的 TypeScript：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-bash"><code><span class="token comment"># for yarn users</span>
yarn upgrade typescript
<span class="token comment"># for npm users</span>
<span class="token function">npm</span> update typescript
</code></pre>
      </div>
<h3 id="flow"><a href="#flow" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flow</h3>
<p><a href="https://flow.org/">Flow</a> 对 JSX fragment 的语法支持从 <a href="https://github.com/facebook/flow/releases/tag/v0.59.0">0.59 版本</a> 开始！简单运行</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-bash"><code><span class="token comment"># for yarn users</span>
yarn upgrade flow-bin
<span class="token comment"># for npm users</span>
<span class="token function">npm</span> update flow-bin
</code></pre>
      </div>
<p>以升级到最新版本的 Flow。</p>
<h3 id="prettier"><a href="#prettier" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prettier</h3>
<p><a href="https://github.com/prettier/prettier">Prettier</a> 将在他们<a href="https://github.com/prettier/prettier/pull/3237">即将发布的 1.9 版本</a>中支持 fragment 语法。</p>
<h3 id="eslint"><a href="#eslint" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ESLint</h3>
<p>当其和 <a href="https://github.com/babel/babel-eslint">babel-eslint</a> 一同使用时，<a href="https://eslint.org/">ESLint</a> 3.x 支持 JSX fragment 语法：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-bash"><code><span class="token comment"># for yarn users</span>
yarn add eslint@3.x babel-eslint@7
<span class="token comment"># for npm users</span>
<span class="token function">npm</span> <span class="token function">install</span> eslint@3.x babel-eslint@7
</code></pre>
      </div>
<p>若你已经在使用，则将其升级：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-bash"><code><span class="token comment"># for yarn users</span>
yarn upgrade eslint@3.x babel-eslint@7
<span class="token comment"># for npm users</span>
<span class="token function">npm</span> update eslint@3.x babel-eslint@7
</code></pre>
      </div>
<p>确保将下面这行代码添加进你的 <code>.babelrc</code> 文件:</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsxon"><code>"parser": "babel-eslint"</code></pre>
      </div>
<p>仅此而已！</p>
<p>注意 <code>babel-eslint</code> 并非由 ESLint 官方支持。我们将在未来几周寻求将对 fragment 的支持添加到 ESLint 4.x 上。</p>
<h3 id="编辑器支持"><a href="#%E7%BC%96%E8%BE%91%E5%99%A8%E6%94%AF%E6%8C%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编辑器支持</h3>
<p>其可能会花费些时间来让你的文本编辑器支持 fragment 语法。请对社区采纳这一最新的变更保持些耐心。同时，如果你的编辑器仍未支持 fragment 语法，你可能会看到些错误或异常的高亮语法。通常来讲，这些错误可以被安全地忽略。</p>
<h4 id="typescript-编辑器支持"><a href="#typescript-%E7%BC%96%E8%BE%91%E5%99%A8%E6%94%AF%E6%8C%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TypeScript 编辑器支持</h4>
<p>如果你是一位 TypeScript 用户 — 好消息！<a href="https://www.microsoft.com/en-us/download/details.aspx?id=48593">Visual Studio 2015</a>，<a href="https://www.microsoft.com/en-us/download/details.aspx?id=55258">Visual Studio 2017</a> 以及 <a href="https://packagecontrol.io/packages/TypeScript">Sublime Text via Package Control</a> 已经支持了 JSX fragment。Visual Studio Code 也将很快进行更新，但<a href="https://code.visualstudio.com/Docs/languages/typescript#_using-newer-typescript-versions">需要配置其 TypeScript 版本为 2.6.2 及之后</a>。</p>
<h3 id="其他工具"><a href="#%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其他工具</h3>
<p>对于其他工具，请检查对应的文档以查看其是否支持。然而，如果你被你的工具所阻碍，你可以先采用 <code>&#x3C;Fragment></code> 组件并在工具能够正确支持之后用 codemod 将其进行替换为缩写语法。</p>
<h2 id="安装"><a href="#%E5%AE%89%E8%A3%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装</h2>
<p>React v16.2.0 已经发布到 npm 仓库上。</p>
<p>通过 Yarn 安装 React 16，运行：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-bash"><code>yarn add react@^16.2.0 react-dom@^16.2.0
</code></pre>
      </div>
<p>通过 npm 安装 React 16，运行：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save react@^16.2.0 react-dom@^16.2.0
</code></pre>
      </div>
<p>我们也通过 CDN 提供了一个 UMD 构建的 React 版本：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">crossorigin</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://unpkg.com/react@16/umd/react.production.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">crossorigin</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://unpkg.com/react-dom@16/umd/react-dom.production.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre>
      </div>
<p>查阅文档了解<a href="/docs/installation.html">安装细节说明</a>。</p>
<h2 id="变更日志"><a href="#%E5%8F%98%E6%9B%B4%E6%97%A5%E5%BF%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>变更日志</h2>
<h3 id="react"><a href="#react" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React</h3>
<ul>
<li>为 React 添加名为 <code>Fragment</code> 的导出（export）对象。（<a href="https://github.com/clemmy">@clemmy</a> 在 <a href="https://github.com/facebook/react/pull/10783">#10783</a> 提的 PR）</li>
<li>在 <code>React.Children</code> 的工具集中增加试验性的 Call/Return 类型。（<a href="https://github.com/MatteoVH">@MatteoVH</a> 在 <a href="https://github.com/facebook/react/pull/11422">#11422</a> 提的 PR）</li>
</ul>
<h3 id="react-dom"><a href="#react-dom" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React DOM</h3>
<ul>
<li>修复当使用多列单选按钮，单选按钮无法被选中。（<a href="https://github.com/landvibe">@landvibe</a> 在 <a href="https://github.com/facebook/react/pull/11227">#11227</a> 提的 PR）</li>
<li>修复单选按钮在某些情况下无法接受到 <code>onChange</code> 事件。（<a href="https://github.com/jquense">@jquense</a> 在 <a href="https://github.com/facebook/react/pull/11028">#11028</a> 提的 PR）</li>
</ul>
<h3 id="react-test-renderer"><a href="#react-test-renderer" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React Test Renderer</h3>
<ul>
<li>修复当在 <code>componentWillMount</code> 调用 <code>setState()</code> 时，其回调函数过早调用的问题。（<a href="https://github.com/accordeiro">@accordeiro</a> 在 <a href="https://github.com/facebook/react/pull/11507">#11507</a> 提的 PR）</li>
</ul>
<h3 id="react-reconciler"><a href="#react-reconciler" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React Reconciler</h3>
<ul>
<li>发布 <code>react-reconciler/reflection</code> 帮助公用的自定义渲染器。（<a href="https://github.com/rivenhk">@rivenhk</a> 在 <a href="https://github.com/facebook/react/pull/11683">#11683</a> 提及的 PR）</li>
</ul>
<h3 id="内部变更"><a href="#%E5%86%85%E9%83%A8%E5%8F%98%E6%9B%B4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内部变更</h3>
<ul>
<li>许多公开的 API 测试用例被重写。非常感谢<a href="https://github.com/facebook/react/issues/11299">每一位的贡献</a>！</li>
</ul>
<h2 id="感谢"><a href="#%E6%84%9F%E8%B0%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>感谢</h2>
<p>本次发布由我们的开源贡献者完成。非常感谢提交问题的人，对语法讨论的贡献和审阅 PR，在第三方库中增加 JSX fragment 支持等等！</p>
<p>尤为感谢  <a href="https://www.typescriptlang.org/">TypeScript</a> 和 <a href="https://flow.org/">Flow</a> 团队，以及 <a href="https://babeljs.io/">Babel</a> 的维护者们，帮助为新语法在工具上提供了无缝支持。</p>
<p>感谢 <a href="https://github.com/gajus/">Gajus Kuizinas</a> 和其他贡献者在开源社区提出了 <code>Fragment</code> 的原型。</p>]]></description><link>https://doc.react-china.org/blog/2017/11/28/react-v16.2.0-fragment-support.html</link><guid isPermaLink="false">https://doc.react-china.org/blog/2017/11/28/react-v16.2.0-fragment-support.html</guid><pubDate>Tue, 28 Nov 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[React v16.0]]></title><description><![CDATA[<p>我们非常激动地宣布 React v16.0 发布了！这些变更包含了一些存在已久的特性，包括<a href="#new-render-return-types-fragments-and-strings"><strong>碎片（fragments）</strong></a>，<a href="#better-error-handling"><strong>错误边界</strong></a>，<a href="#portals"><strong>portals</strong></a>，支持<a href="#support-for-custom-dom-attributes"><strong>自定义 DOM 属性</strong></a>，提升[<strong>服务端渲染</strong>]以及<a href="#reduced-file-size"><strong>减小库的大小</strong></a>。</p>
<h3 id="新的渲染返回类型：碎片和字符串"><a href="#%E6%96%B0%E7%9A%84%E6%B8%B2%E6%9F%93%E8%BF%94%E5%9B%9E%E7%B1%BB%E5%9E%8B%EF%BC%9A%E7%A2%8E%E7%89%87%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>新的渲染返回类型：碎片和字符串</h3>
<p>现在你可以从组件的渲染方法中返回一个包含元素的数组。类似于其他数组，但你需要为每一个元素添加key以避免警告：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// No need to wrap list items in an extra element!</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token comment">// Don't forget the keys :)</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>A<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>First item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>B<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Second item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>C<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Third item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>未来，我们很可能会给 JSX 增加一种不需要 key 的特殊碎片语法。</p>
<p>我们也添加了对返回字符串的支持：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'Look ma, no spans!'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p><a href="/docs/react-component.html#render">查看完整的支持的返回类型列表</a>。</p>
<h3 id="更好的错误处理"><a href="#%E6%9B%B4%E5%A5%BD%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>更好的错误处理</h3>
<p>之前，渲染时的运行错误会使得 React 进入错误状态，生成加密的错误信息并需要页面进行刷新。为处理这一问题， React 16 使用了更具弹性的错误处理策略。默认情况下，若错误在组件内的渲染或生命周期方法被抛出，整个组件从根开始都不会渲染。这阻止了错误信息的显示。然而，其也可能不是理想的用户体验。</p>
<p>你可以使用错误边界，而非每次出现错误时卸载整个应用。错误边界是用以在子树内部捕获错误并在其位置展示回退 UI 的特殊组件。可以认为错误边界类似于 try-catch 语句，但针对 React 组件。</p>
<p>更多细节，查看我们<a href="/blog/2017/07/26/error-handling-in-react-16.html">之前的关于 React 16 的错误处理的文章</a>。</p>
<h3 id="portals"><a href="#portals" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Portals</h3>
<p>Portals 提供了一种很好的将子节点渲染到父组件以外的 DOM 节点的方式。</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// React does *not* create a new div. It renders the children into `domNode`.</span>
  <span class="token comment">// `domNode` is any valid DOM node, regardless of its location in the DOM.</span>
  <span class="token keyword">return</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createPortal</span><span class="token punctuation">(</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">,</span>
    domNode<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>可以在 <a href="/docs/portals.html">关于 portals 的文档</a> 查看完成的例子。</p>
<h3 id="更好的服务端渲染"><a href="#%E6%9B%B4%E5%A5%BD%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>更好的服务端渲染</h3>
<p>React 16 包含了一个完全重写的服务端渲染器。其是真的快。支持<strong>流</strong>，因此你能够更快地将数据发送到客户端。同时由于<a href="#reduced-file-size">新的打包策略</a> 即编译不再进行 <code>process.env</code> 检查（不论你相信与否，在 Node 中读取 <code>process.env</code> 是真的慢！），你不再需要打包React以获得良好的服务端渲染性能。</p>
<p>核心团队成员 Sasha Aickin 写了一篇<a href="https://medium.com/@aickin/whats-new-with-server-side-rendering-in-react-16-9b0d78585d67">不错的描述 React 16 服务端渲染的提升</a>。根据 Sasha 的综合的基准测试，React 16 的服务端渲染要比 React 15 快大概<strong>三倍</strong>。“与带有 <code>process.env</code> 编译后 React 15 比较，在 Node 4 下大约有 2.4x 的性能提升，在 Node 6 下大概有 3.x 的性能提升，在新发布的 Node 8.4下有 3.8x 的性能提升。若与未编译的 React 15进行比较，在最新版本的 Node下，React 16 在服务端渲染有一整个量级的增益！”（根据 Sasha 指出，请注意这些数字是基于综合的基准测试得出的并不一定能反映出真实的性能。）</p>
<p>此外，一旦到达客户端，React 16 更擅长于保留服务端的HTML。其不再要求初始渲染完全匹配服务端的渲染结果。相反，其会尝试尽可能重用现有的 DOM 元素。不再进行 checksums 校验！通常来讲，我们不推荐在客户端渲染和服务端不同的内容，但在某些情况是有用的（例如：时间戳）。</p>
<p>查看<a href="/docs/react-dom-server.html">关于 <code>ReactDOMServer</code> 的文档</a> 了解更多细节。</p>
<h3 id="支持自定义-dom-属性"><a href="#%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89-dom-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>支持自定义 DOM 属性</h3>
<p>React 现在会<a href="https://facebook.github.io/react/blog/2017/09/08/dom-attributes-in-react-16.html">将自定义属性传递给 DOM</a>，而不是忽略不认识的 HTML 和 SVG 属性。这使得我们能够不必在维护的 React 特性的白名单，并能够减少文件体积。</p>
<h3 id="减少文件体积"><a href="#%E5%87%8F%E5%B0%91%E6%96%87%E4%BB%B6%E4%BD%93%E7%A7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>减少文件体积</h3>
<p>除了这些外，React 16 确实要小于 15.6.1！</p>
<ul>
<li><code>react</code> 从20.7kb（gzip 后：6.9 kb）减至大小为 5.3 kb（gzip 后：2.2 kb）。</li>
<li><code>react-dom</code> 从141 kb（gzip 后：42.9 kb）减至 103.7 kb（gzip 后：32.6 kb）。</li>
<li><code>react</code> + <code>react-dom</code> 从 161.7 kb（gzip 后：49.8 kb）减至 109 kb（gzip 后：34.8 kb）</li>
</ul>
<p>二者结合<strong>相较于之前的版本体积减少了32%（gzip 后30%）。</strong></p>
<p>体积的差异主要因为包的变化。React 现在使用 <a href="https://rollupjs.org/">Rollup</a> 来进行扁平化的打包以处理不同目标格式，而这使得体积和性能都有了提高。扁平化的包格式也意味着 React 对包的体积大小影响大致一直，无论你如何运行你的应用程序，无论是使用 Webpack、Browserify 还是预构建的 UMD 包或其他系统。</p>
<h3 id="mit-协议"><a href="#mit-%E5%8D%8F%E8%AE%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MIT 协议</h3>
<p><a href="https://code.facebook.com/posts/300798627056246/relicensing-react-jest-flow-and-immutable-js/">以防你错过</a>，React 16 使用 MIT 协议。我们也为那些无法立刻升级的人在 MIT 协议下发布了 React 15.6.2。</p>
<h3 id="新核心架构"><a href="#%E6%96%B0%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>新核心架构</h3>
<p>React 16 是第一个从顶层采用全新的核心架构的版本，代号 “Fiber”。你可以在<a href="https://code.facebook.com/posts/1716776591680069/react-16-a-look-inside-an-api-compatible-rewrite-of-our-frontend-ui-library/">Facebook 的工程博客</a>上了解这一项目。（Spoiler：我们重写了 React！）</p>
<p>Fiber 负责大部分 React 16 里的新特性，例如错误边界和 fragments。而在接下来的几个版本中，你可以期待我们解锁更多 React 的潜在特性。</p>
<p>可能目前我们的工作最为激动的领域是 <strong>异步渲染</strong> - 一种周期性地对浏览器执行调度渲染工作的策略。结果如下，通过异步渲染，应用能够更好的响应，因为 React 避免阻塞了主线程。</p>
<p>这一示例为异步渲染可以解决的问题提供了一个先导（译注：即异步渲染可以解决什么样的问题）：</p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">有考虑过什么是 &quot;异步渲染&quot;？这有一个 Demo 展示了如何在无 React 下协调异步 React 树工作。
<a href="https://t.co/3snoahB3uV">https://t.co/3snoahB3uV</a>
<a href="https://t.co/egQ988gBjR">pic.twitter.com/egQ988gBjR</a></p>&mdash; Andrew Clark (@acdlite) <a href="https://twitter.com/acdlite/status/909926793536094209">September 18, 2017</a></blockquote>
<p><em>提示：留意旋转的黑色方块。</em></p>
<p>我们认为异步渲染是一次大动作，并代表了 React 的未来。为保证尽可能平稳地迁移到 v16.0，我们目前仍并没有支持异步特性，但我们非常期待能在接下来几个月将他们推出。保持关注！</p>
<h2 id="安装"><a href="#%E5%AE%89%E8%A3%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装</h2>
<p>React v16.0.0 已可通过 npm 进行安装。</p>
<p>通过 Yarn 安装 React 16，执行：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-bash"><code>yarn add react@^16.0.0 react-dom@^16.0.0
</code></pre>
      </div>
<p>通过 npm 安装 React 16，执行：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save react@^16.0.0 react-dom@^16.0.0
</code></pre>
      </div>
<p>我们也通过CDN提供了 UMD 方式构建的 React：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">crossorigin</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://unpkg.com/react@16/umd/react.production.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">crossorigin</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://unpkg.com/react-dom@16/umd/react-dom.production.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre>
      </div>
<p><a href="/docs/installation.html">关于安装说明的细节</a>可以查看文档。</p>
<h2 id="升级"><a href="#%E5%8D%87%E7%BA%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>升级</h2>
<p>尽管 React 16 包含了重大的内部变更，就升级而言，你可以认为这和其他主要版本的 React 发布类似。自今年早些时候我们已经用 React 16 服务了 Facebook 和 Messenger.com的用户，同时我们发布几个 beta 版本和 补丁 版本以解决额外的问题。除了一些小的意外，<strong>若你的应用运行在 15.6 版本上且没有任何警告，那么其应该也能够在 16 下正常工作。</strong></p>
<h3 id="新的弃用"><a href="#%E6%96%B0%E7%9A%84%E5%BC%83%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>新的弃用</h3>
<p>保留（Hydrating）服务端渲染的容器现在有了更清晰的 API 定义。若你想重用服务端渲染的 HTML，使用 <a href="/docs/react-dom.html#hydrate"><code>ReactDOM.hydrate</code></a> 而不是 <code>ReactDOM.render</code>。若你只是想做客户端渲染则继续使用 <code>ReactDOM.render</code> 即可。</p>
<h3 id="react-附加套件"><a href="#react-%E9%99%84%E5%8A%A0%E5%A5%97%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React 附加套件</h3>
<p>如之前宣称，我们<a href="/blog/2017/04/07/react-v15.5.0.html#discontinuing-support-for-react-addons">不再为 React Addons 增加支持</a>。我们期望每个附加套件（除<code>react-addons-perf</code>；查看之前）能够在可见的未来中继续工作，但我们不会再发布额外的更新。</p>
<p>关于<a href="/blog/2017/04/07/react-v15.5.0.html#discontinuing-support-for-react-addons">如何迁移的建议</a>可以参考之前的博客。</p>
<p><code>react-addons-perf</code> 无法在React 16中继续工作。在之后我们可能会发布一个新版工具。同时，你可以<a href="/docs/optimizing-performance.html#profiling-components-with-the-chrome-performance-tab">使用你的浏览器性能工具来测量 React 组件</a>。</p>
<h3 id="更新"><a href="#%E6%9B%B4%E6%96%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>更新</h3>
<p>React 16 包含了一系列小的变革。这些变革仅会影响一些不常用的示例，而我们并不希望他们会干扰大多数应用。</p>
<ul>
<li>React 15 已对使用 <code>unstable_handleError</code> 进行了限制，不再为错误边界提供文档支持。该方法已重命名为 <code>componentDidCatch</code>。你可以使用 codemod来<a href="https://github.com/reactjs/react-codemod#error-boundaries">自动地迁移代码到新的 API</a>。</li>
<li>若在生命周期方法内部调用 <code>ReactDOM.render</code> 和 <code>ReactDOM.unstable_renderIntoContainer</code> ，则其返回空。为使其继续工作，你可以使用 <a href="https://github.com/facebook/react/issues/10309#issuecomment-318433235">portals</a> 或 <a href="https://github.com/facebook/react/issues/10309#issuecomment-318434635">refs</a>。</li>
<li>
<p><code>setState</code>:</p>
<ul>
<li>通过 null 调用 <code>setState</code> 不再触发更新。这允许你确定在更新函数里你是否想要重新渲染。</li>
<li>在 render 方法里调用 <code>setState</code> 会触发更新。这不同于之前。无论如何，你不应该在 render 里调用 setState。</li>
<li><code>setState</code> 回调函数（第二个参数）现在会在 <code>componentDidMount</code> / <code>componentDidUpdate</code>之后立刻触发，而非等到所有组件都已渲染。</li>
</ul>
</li>
<li>当使用 <code>&#x3C;B /></code> 来替换 <code>&#x3C;A /></code>，<code>B.componentWillMount</code> 现在会在 <code>A.componentWillUnmount</code> 之前触发。之前，在某些情况下，<code>A.componentWillUnmount</code> 会立刻触发。</li>
<li>之前，改变组件的引用总会导致在组件渲染之前解除引用。现在当修改 DOM 节点时，我们将引用的调整置后。</li>
<li>重渲到一个并非由 React 修改的容器里的方式并不安全。这在之前某些情况能够工作但 React 不再支持。现在我们在这一情况下会触发一个警告。你应该清理你组件树中使用 <code>ReactDOM.unmountComponentAtNode</code> 的组件。<a href="https://github.com/facebook/react/issues/10294#issuecomment-318820987">查看这一例子。</a></li>
<li><code>componentDidUpdate</code> 生命周期方法将不再传递 <code>prevContext</code> 参数。（查看 <a href="https://github.com/facebook/react/issues/8631">#8631</a>）</li>
<li>浅渲染器不再调用 <code>componentDidUpdate</code> 因为 DOM 引用并不可用。这也和 <code>componentDidMount</code> 保持一致（之前的版本亦不会调用 <code>componentDidMount</code> ）。</li>
<li>浅渲染器不再实现 <code>unstable_batchedUpdates</code></li>
</ul>
<h3 id="包"><a href="#%E5%8C%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>包</h3>
<ul>
<li>不再有 <code>react/lib/*</code> 和 <code>react-dom/lib/*</code>。即使在 CommonJS 环境下，React 和 ReactDOM也会预编译为单文件（“扁平包（flat bundles）”）。若你之前依赖于文档未标明的 React 内部方法，则他们不再有效，可以在新的 issue 说明你的具体情况，同时我们也会尽可能为你提供迁移建议。</li>
<li>不再有 <code>react-with-addons.js</code> 构建包。所有兼容的附加组件都单独地在 npm 上发布，若你需要，也对应有单文件的浏览器版本。</li>
<li>在 15.x 介绍的弃用已经从核心 package 中移除。<code>React.createClass</code> 可用 <code>create-react-class</code> 来替代，<code>React.PropTypes</code> 用 <code>prop-types</code> 来代替，<code>react-dom-factories</code> 来代替 <code>React.DOM</code>，<code>react-dom/test-utils</code> 来代替 <code>react-addons-test-utils</code> 以及浅渲染器可用 <code>react-test-renderer/shallow</code>。 查看 <a href="https://facebook.github.io/react/blog/2017/04/07/react-v15.5.0.html">15.5.0</a> 和 <a href="https://facebook.github.io/react/blog/2017/06/13/react-v15.6.0.html">15.6.0</a> 的博客文章来了解代码迁移和自动化代码修改（codemods）的建议。</li>
<li>
<p>对于单文件的浏览器构建版本名字和路径做了调整以强调开发和生产版本之前的差异。例如：</p>
<ul>
<li><code>react/dist/react.js</code> → <code>react/umd/react.development.js</code></li>
<li><code>react/dist/react.min.js</code> → <code>react/umd/react.production.min.js</code></li>
<li><code>react-dom/dist/react-dom.js</code> → <code>react-dom/umd/react-dom.development.js</code></li>
<li><code>react-dom/dist/react-dom.min</code>.js → <code>react-dom/umd/react-dom.production.min.js</code></li>
</ul>
</li>
</ul>
<h2 id="javascript环境要求"><a href="#javascript%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JavaScript环境要求</h2>
<p>React 16 依赖于集合类型 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a> 和 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a>。若你要支持老式的可能未提供原生支持的浏览器和设备（例如 IE &#x3C; 11），考虑在你的应用库中包含一个全局的 polyfill，例如 <a href="https://github.com/zloirock/core-js">core-js</a> 或 <a href="https://babeljs.io/docs/usage/polyfill/">babel-polyfill</a>。</p>
<p>一个使用 core-js 支持老版浏览器的 React 16 polyfill 环境大致如下：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token keyword">import</span> <span class="token string">'core-js/es6/map'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'core-js/es6/set'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello<span class="token punctuation">,</span> world<span class="token operator">!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<p>React 也依赖于 <code>requestAnimationFrame</code> （甚至包括测试环境）。一个在测试环境下的简单 shim 如下：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code>global<span class="token punctuation">.</span><span class="token function-variable function">requestAnimationFrame</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<h2 id="感谢"><a href="#%E6%84%9F%E8%B0%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>感谢</h2>
<p>一如既往，此次发布没有开源社区贡献将无法完成。感谢每一位提bug，开PR，回答问题，编写文档以及其他有所贡献的人们！</p>
<p>尤其感谢我们的核心贡献者，尤其是在过去几周的预发布周期的卓越贡献：<a href="https://twitter.com/aweary">Brandon Dail</a>，<a href="https://twitter.com/monasticpanic">Jason Quense</a>，<a href="https://twitter.com/natehunzaker">Nathan Hunzaker</a>，和 <a href="https://twitter.com/xander76">Sasha Aickin</a>。</p>]]></description><link>https://doc.react-china.org/blog/2017/09/26/react-v16.0.html</link><guid isPermaLink="false">https://doc.react-china.org/blog/2017/09/26/react-v16.0.html</guid><pubDate>Tue, 26 Sep 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[React v15.6.2]]></title><description><![CDATA[<p>今天我们发布了 React 15.6.2。在 15.6.1，我们为产生的一些意外结果的变更事件和输入进行了修复。这些问题已经被消除，同时我们也包含了一些用于提高 React 跨浏览器稳定性的补丁。</p>
<p>此外，15.6.2 增加了 <a href="https://developers.google.com/web/updates/2017/03/chrome-58-media-updates#controlslist"><code>controlList</code></a> 特性，以及 CSS columns 不再需要添加 <code>px</code> 后缀。</p>
<h2 id="安装"><a href="#%E5%AE%89%E8%A3%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装</h2>
<p>我们推荐使用 <a href="https://yarnpkg.com/">Yarn</a>或 <a href="https://www.npmjs.com/">npm</a>来管理前端依赖。若你是初次接触包管理器，<a href="https://yarnpkg.com/en/docs/getting-started">Yarn 文档</a>是一个不错的起点。</p>
<p>通过Yarn安装React，运行：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-bash"><code>yarn add react@^15.6.0 react-dom@^15.6.0
</code></pre>
      </div>
<p>通过npm安装React，运行：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save react@^15.6.0 react-dom@^15.6.0
</code></pre>
      </div>
<p>我们推荐如 <a href="https://webpack.js.org/">webpack</a> 或 <a href="http://browserify.org/">Browserify</a> 打包器，以让你可以编写模块化代码并将其打包到一起放在一个小的包内以优化加载时间。</p>
<p>记住默认情况下，React 在开发模式下运行会带有额外检查并提供有用的警告。当部署你的应用时，确保其<a href="/react/docs/installation.html#development-and-production-versions">在生产模式编译</a>。</p>
<p>万一你未使用打包器，我们也提供了一个预先构建好的包在npm上，你可以在你的页面中<a href="/react/docs/installation.html#using-a-cdn">通过script标签引入</a>：</p>
<ul>
<li><strong>React</strong><br/>
带警告的开发版本: <a href="https://unpkg.com/react@15.6.2/dist/react.js">react/dist/react.js</a><br/>
用于生产的压缩版本: <a href="https://unpkg.com/react@15.6.2/dist/react.min.js">react/dist/react.min.js</a><br/></li>
<li><strong>React with Add-Ons</strong><br/>
带警告的开发版本: <a href="https://unpkg.com/react@15.6.2/dist/react-with-addons.js">react/dist/react-with-addons.js</a><br/>
用于生产的压缩版本: <a href="https://unpkg.com/react@15.5.2/dist/react-with-addons.min.js">react/dist/react-with-addons.min.js</a><br/></li>
<li><strong>React DOM</strong> (页面中在React DOM之前引入React) <br/>
带警告的开发版本: <a href="https://unpkg.com/react-dom@15.6.2/dist/react-dom.js">react-dom/dist/react-dom.js</a><br/>
用于生产的压缩版本: <a href="https://unpkg.com/react-dom@15.6.2/dist/react-dom.min.js">react-dom/dist/react-dom.min.js</a><br/></li>
<li><strong>React DOM Server</strong> (页面中在 React DOM Server 之前引入 React)<br/>
带警告的开发版本: <a href="https://unpkg.com/react-dom@15.6.2/dist/react-dom-server.js">react-dom/dist/react-dom-server.js</a><br/>
用于生产的压缩版本: <a href="https://unpkg.com/react-dom@15.6.2/dist/react-dom-server.min.js">react-dom/dist/react-dom-server.min.js</a><br/></li>
</ul>
<p>我们还在 npm 上发布了 <code>react</code>，<code>react-dom</code> 及附件包的<code>15.6.2</code> 版本以及在bower上发布了 <code>react</code> 包。</p>
<hr>
<h2 id="changelog"><a href="#changelog" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Changelog</h2>
<h2 id="1562-september-25-2017"><a href="#1562-september-25-2017" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>15.6.2 (September 25, 2017)</h2>
<h3 id="所有包"><a href="#%E6%89%80%E6%9C%89%E5%8C%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>所有包</h3>
<ul>
<li>从 BSD + Patents 切换到 MIT 协议</li>
</ul>
<h3 id="react-dom"><a href="#react-dom" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React DOM</h3>
<ul>
<li>修复了当 <code>document.documentMode</code> 被修改时，在其他浏览器触发了 IE检测而中断了变更事件的 bug。（<a href="https://github.com/aweary">@aweary</a> 在 <a href="https://github.com/facebook/react/pull/10032">#10032</a> 提及）</li>
<li>CSS Columns 会被认为是无单位的数字。（<a href="https://github.com/aweary">@aweary</a> 在 <a href="https://github.com/facebook/react/pull/10115">#10115</a> 提及）</li>
<li>Fix bug in QtWebKit when wrapping synthetic events in proxies. (<a href="https://github.com/walrusfruitcake">@walrusfruitcake</a> in <a href="https://github.com/facebook/react/pull/10011">#10115</a>)</li>
<li>修复了在 QtWebKit下合成事件包装在 proxies 的 bug。（<a href="https://github.com/walrusfruitcake">@walrusfruitcake</a> 在 <a href="https://github.com/facebook/react/pull/10011">#10115</a> 提及）</li>
<li>在开发环境下阻止事件处理器接受额外参数。（<a href="https://github.com/aweary">@aweary</a> 在 <a href="https://github.com/facebook/react/pull/8363">#10115</a> 提及）</li>
<li>修复带有 <code>defaultChecked</code> 单选框（radio）不触发 <code>onChange</code> 的情况。（<a href="https://github.com/jquense">@jquense</a> 在 <a href="https://github.com/facebook/react/pull/10156">#10156</a> 提及）</li>
<li>将 <code>controlList</code> 添加到 DOM 特性白名单（<a href="https://github.com/nhunzaker">@nhunzaker</a> 在 <a href="https://github.com/facebook/react/pull/9940">#9940</a> 提及）</li>
<li>修复了开发环境下当在构造函数里创建带有 ref 的元素并未抛出异常。（<a href="https://github.com/iansu">@iansu</a> 在 <a href="https://github.com/facebook/react/pull/10025">#10025</a> 提及）</li>
</ul>]]></description><link>https://doc.react-china.org/blog/2017/09/25/react-v15.6.2.html</link><guid isPermaLink="false">https://doc.react-china.org/blog/2017/09/25/react-v15.6.2.html</guid><pubDate>Mon, 25 Sep 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[DOM Attributes in React 16]]></title><description><![CDATA[<p>过去，React 习惯于忽视未知的 DOM 属性。若你在 JSX 中写了一个 React 无法识别的元素， React 将会忽略他。例如这样：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token comment">// Your code:</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">mycustomattribute</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>something<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre>
      </div>
<p>在 React 15 中将会在 DOM 节点中渲染一个空的 div:</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token comment">// React 15 output:</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">/></span></span>
</code></pre>
      </div>
<p>在 React 16 中，我们做了一些改变。未知特性会在 DOM 节点的末尾：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token comment">// React 16 output:</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">mycustomattribute</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>something<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre>
      </div>
<h2 id="为何要改变？"><a href="#%E4%B8%BA%E4%BD%95%E8%A6%81%E6%94%B9%E5%8F%98%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为何要改变？</h2>
<p>React 为 DOM 提供了以 JavaScript 为核心的 API。由于 React 组件总是带有自定义以及 DOM 相关的 props，其使得 React 使用小驼峰命名会更易理解，类似于 DOM 的 API：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">tabIndex</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>-1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre>
      </div>
<p>这并未改变。然而，过去这一方式强制我们在库中维护一个合法的 DOM 元素白名单：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token comment">// ...</span>
summary<span class="token punctuation">:</span> <span class="token string">'summary'</span><span class="token punctuation">,</span>
tabIndex<span class="token punctuation">:</span> <span class="token string">'tabindex'</span>
target<span class="token punctuation">:</span> <span class="token string">'target'</span><span class="token punctuation">,</span>
title<span class="token punctuation">:</span> <span class="token string">'title'</span><span class="token punctuation">,</span>
<span class="token comment">// ...</span>
</code></pre>
      </div>
<p>这一方是有两个弊端：</p>
<ul>
<li>
<p>你无法<a href="https://github.com/facebook/react/issues/140">传自定义属性</a>。而这对于未标准化的浏览器相关的属性，尝试新的DOM API以及集成一些独特的第三方库。</p>
</li>
<li>
<p>属性列表不断地增长，但 大部分 React 独有的属性命名已在 DOM 中合法。移除白名单的大部分属性能够稍微减少库的大小。</p>
</li>
</ul>
<p>随着新版本发布，这些问题都将解决。在 React 16 中，你可以传递自定义属性给所有的 HTML 和 SVG 元素，同时 React 也不必在将所有的属性白名单包含进生产版本里。</p>
<p><strong>注意，对于已知属性，你仍需要使用规范的 React 命名。</strong></p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token comment">// Yes, please</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">tabIndex</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>-1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

<span class="token comment">// Warning: Invalid DOM property `tabindex`. Did you mean `tabIndex`?</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>-1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre>
      </div>
<p>换句话说，你在 React 中使用 DOM 组件的方式并没有改变，但现在你有了新方式。</p>
<h2 id="应该在属性中存储数据？"><a href="#%E5%BA%94%E8%AF%A5%E5%9C%A8%E5%B1%9E%E6%80%A7%E4%B8%AD%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应该在属性中存储数据？</h2>
<p>不。我们不鼓励奖数据存放在 DOM 属性中。即使你不得不，使用 <code>data-</code>
可能会是更好的方式，但大多数情况下数据应被保存在 React 组件状态或额外存储。</p>
<p>然而，若你需要使用非标准化的或是新的 DOM 属性那新特性将会十分方便，或若你需要与依赖这些新特性的第三方库进行整合。</p>
<h2 id="data-和-aria-属性"><a href="#data-%E5%92%8C-aria-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Data 和 ARIA 属性</h2>
<p>和之前一样，React 能够让你随意地传递 <code>data-</code> 和 <code>aria-</code>：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-foo</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>42<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Close<span class="token punctuation">"</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>onClose<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
</code></pre>
      </div>
<p>这并没有改变。</p>
<p><a href="/react/docs/accessibility.html">可访问性</a> 非常重要，因此即使 React 16 能够传递任何属性，其仍然会在开发模式下验证 <code>aria-</code> props 是否正确命名，就像之前 React 15 一样。</p>
<h2 id="迁移路径"><a href="#%E8%BF%81%E7%A7%BB%E8%B7%AF%E5%BE%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>迁移路径</h2>
<p>自一年多前的 <a href="https://github.com/facebook/react/releases/tag/v15.2.0">React 15.2.0</a> 发布，我们已将<a href="/react/warnings/unknown-prop.html">关于未知属性的一个警告</a> 包含在内。大量的第三方库也已进行代码升级。若你的应用在 React 15.2.0 或更高版本中并未产生警告，那么这一改变并不需要修改你应用中的代码。</p>
<p>若你仍意外地传递非 DOM props 到 DOM 组件中，在 React 16 你将会在 DOM 中开始看到这些特性，例如：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">myData</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>[Object object]<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span>
</code></pre>
      </div>
<p>这在一定程度上是安全的（浏览器将会忽略他们）但当你看到他们时，我们建议你修复这些问题。一个潜在的问题是若你传递一个实现了自定义的 <code>toString()</code> 或 <code>valueOf()</code> 方法的对象将会抛出异常。另一个可能的问题是合法的 HTML 元素如 <code>align</code> 和 <code>valign</code> 现在会被传递给 DOM。它们过去则是被忽略，因为React 并不支持它们。</p>
<p>为避免这些问题，在升级到 React 16 之前，我们建议你修复你在 React 15中看到的这些警告。</p>
<h2 id="变更细节"><a href="#%E5%8F%98%E6%9B%B4%E7%BB%86%E8%8A%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>变更细节</h2>
<p>我们已做了一些其他调整已让行为能够更加可预测并能致力于让你不犯错。我们无法预期这些改变可能会破坏实际应用。</p>
<p><strong>这些变更仅影响 DOM 组件 如 <code>&#x3C;div></code>，而不会影响你自己的组件。</strong></p>
<p>下列是变更的细节。</p>
<ul>
<li>
<p><strong>带有字符，数字或对象值得未知属性：</strong></p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">mycustomattribute</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">mycustomattribute</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token number">42</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">mycustomattribute</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>myObject<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
</code></pre>
      </div>
<p>React 15：警告并忽略。
React 16：将值转换成字符串并传递给组件。</p>
<p><em>注意：以 <code>on</code> 开始的特性并不会被传递而是抛出异常因为这可能是一个潜在的安全漏洞。</em></p>
</li>
<li>
<p><strong>带有不同规范的 React 命名的已知属性：</strong></p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>-1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hi<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre>
      </div>
<p>React 15：警告并忽略。
React 16：警告但会将其转换为字符串并传递给组件。</p>
<p><em>注意：永远对支持的特性使用规范的 React 命名规则。</em></p>
</li>
<li>
<p><strong>带有布尔值的非布尔值特性：</strong></p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
</code></pre>
      </div>
<p>React 15：将布尔值转换为字符串并传递给组件
React 16：警告并忽略。</p>
</li>
<li>
<p><strong>带有函数的非事件特性：</strong></p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
</code></pre>
      </div>
<p>React 15：将函数转换为字符串并传递给组件。
React 16：警告并忽略。</p>
</li>
<li>
<p><strong>带有 Symbol 的属性：</strong></p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
</code></pre>
      </div>
<p>React 15：崩溃。
React 16：警告并忽略。</p>
</li>
<li>
<p><strong>带有 <code>NaN</code> 值的属性：</strong></p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">tabIndex</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token number">0</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
</code></pre>
      </div>
<p>React 15：将 <code>NaN</code> 转换为字符串并传递给组件。
React 16：警告并忽略。</p>
</li>
</ul>
<p>随这一测试版的发布，我们也为所有已知元素<a href="https://github.com/facebook/react/blob/master/fixtures/attribute-behavior/AttributeTableSnapshot.md">创建一个自动生成的表单</a>以追踪潜在的问题。</p>
<h2 id="试一试"><a href="#%E8%AF%95%E4%B8%80%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>试一试</h2>
<p>你可以在 <a href="https://codepen.io/gaearon/pen/gxNVdP?editors=0010">CodePen</a> 尝试这些变更。其使用 React 16 RC 版本，你也可以 <a href="https://github.com/facebook/react/issues/10294">在你的项目中帮助我们测试 RC</a>。</p>
<h2 id="感谢"><a href="#%E6%84%9F%E8%B0%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>感谢</h2>
<p>这一努力大部分由一位 <a href="https://github.com/nhunzaker">Nathan Hunzaker</a> 所推动， <a href="https://github.com/facebook/react/pulls?q=is%3Apr+author%3Anhunzaker+is%3Aclosed">其是一位高产的 React 外部贡献者</a>。</p>
<p>你可以在过去一年的历程里在下列几个 PR 的这个问题上发现他的工作：
<a href="https://github.com/facebook/react/pull/6459">#6459</a>、<a href="https://github.com/facebook/react/pull/7311">#7311</a>、<a href="https://github.com/facebook/react/pull/10229">#10229</a>、<a href="https://github.com/facebook/react/pull/10397">#10397</a>、<a href="https://github.com/facebook/react/pull/10385">#10385</a> 和 <a href="https://github.com/facebook/react/pull/10470">#10470</a>。</p>
<p>在一个受欢迎的项目中核心的调整需要花费大量时间和研究。Nathan 展示了坚定的决心并承诺完成这一调整，我们非常感谢他的这一工作及其他的贡献。</p>
<p>我们也想要感谢 <a href="https://github.com/aweary">Brandon Dail</a> 和 <a href="https://github.com/jquense">Jason Quense</a> 在这一年中无私地帮助维护 React 项目。</p>
<h2 id="未来计划"><a href="#%E6%9C%AA%E6%9D%A5%E8%AE%A1%E5%88%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>未来计划</h2>
<p>我们还未调整 <a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Custom_Elements">自定义元素</a> 如何在 React 16 中工作，但关于设置属性而非特性已经有了一些<a href="https://github.com/facebook/react/issues/7249">讨论</a>，我们可能在 React 17 中在回过头来看看。若你愿意提供帮助，随时都可以来提。</p>]]></description><link>https://doc.react-china.org/blog/2017/09/08/dom-attributes-in-react-16.html</link><guid isPermaLink="false">https://doc.react-china.org/blog/2017/09/08/dom-attributes-in-react-16.html</guid><pubDate>Fri, 08 Sep 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Error Handle in React 16]]></title><description><![CDATA[<p>随着React 16发布在即，我们打算介绍一些在组件内部React如何处理JavaScript错误。这些改变包含在React 16的beta版本中，并将成为React 16的一部分。</p>
<p><strong>顺便一提，<a href="https://github.com/facebook/react/issues/10294">你可以尝试我们刚发布了React 16的第一个测试版本！</a></strong></p>
<h2 id="react-15及之前的行为"><a href="#react-15%E5%8F%8A%E4%B9%8B%E5%89%8D%E7%9A%84%E8%A1%8C%E4%B8%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React 15及之前的行为</h2>
<p>过去，组件内部的JavaScript异常曾经常阻断了React内部状态并导致其在下一次渲染时<a href="https://github.com/facebook/react/issues/6895">触发了隐藏的错误</a>。这些错误常常是由应用程序代码中的早期错误所引起的，但React并未提供一种在组件里优雅处理的方式，也不会从异常中回复。</p>
<h2 id="错误边界介绍"><a href="#%E9%94%99%E8%AF%AF%E8%BE%B9%E7%95%8C%E4%BB%8B%E7%BB%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>错误边界介绍</h2>
<p>UI部分的JavaScript异常不应阻断整个应用。为了为React用户解决这一问题，React 16引入了“错误边界（error boundary”）”这一新概念。</p>
<p>错误边界作为React组件，用以<strong>捕获在子组件树种任何地方的JavaScript异常，打印这些错误，并展示备用UI</strong>而非让组件树崩溃。错误边界会捕获渲染期间，在生命周期方法中以及在其整个树的构造函数中的异常。</p>
<p>若定义一个称为<code>componentDidCatch(error, info)</code>的新生命周期方法，则类组件将成为错误边界：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token keyword">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> hasError<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Display fallback UI</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hasError<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// You can also log the error to an error reporting service</span>
    <span class="token function">logErrorToMyService</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// You can render any custom fallback UI</span>
      <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Something went wrong<span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>而后可作为一个正常组件进行使用：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ErrorBoundary</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MyWidget</span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ErrorBoundary</span><span class="token punctuation">></span></span>
</code></pre>
      </div>
<p><code>componentDidCatch()</code>方法的作用类似于JavaScript的<code>catch {}</code>，但仅针对组件。仅有类组件可以成为错误边界。实际上，大多数时间你会想仅声明一次错误边界组件并在整个应用中使用。</p>
<p>注意，<strong>错误边界仅可以捕获树中后代的组件错误</strong>。一个错误边界无法捕获其自身的错误。若错误边界尝试渲染错误信息失败，则该错误会传递至上方最接近的错误边界。而这也类似JavaScript中的<code>catch {}</code>块的工作方式。</p>
<h2 id="live-demo"><a href="#live-demo" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Live Demo</h2>
<p>查看<a href="https://github.com/facebook/react/issues/10294">在React 16测试版</a>中<a href="https://codepen.io/gaearon/pen/wqvxGa?editors=0010">关于如何声明和使用错误边界的例子</a>。</p>
<h2 id="放置错误边界"><a href="#%E6%94%BE%E7%BD%AE%E9%94%99%E8%AF%AF%E8%BE%B9%E7%95%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>放置错误边界</h2>
<p>错误边界的粒度完全取决于你。你可能将其包装在顶层路由组件中并为用户展示“内部异常（Something went wrong）”的信息，类似于服务端框架处理崩溃。你可能也会在错误边界包装一些内部组件用以保护不会让应用的余下部分不会崩溃。</p>
<h2 id="未捕获错误的新行为"><a href="#%E6%9C%AA%E6%8D%95%E8%8E%B7%E9%94%99%E8%AF%AF%E7%9A%84%E6%96%B0%E8%A1%8C%E4%B8%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>未捕获错误的新行为</h2>
<p>这一改变有一个重要的意义。<strong>作为React 16中不是由错误边界引起的错误将会使得整个React组件树被卸载。</strong></p>
<p>我们曾争论这一决定，但在我们的经验中，将损坏的UI留在那里要比完全移除它要糟糕得多。例如，在类似Messenger这样的产品中留下可见的损坏的UI可能会导致一些人将信息发送给错误的人。类似地，对于支付应用来说显示错误的金额要比什么都不显示糟糕得多。</p>
<p>这一改变意味着随着迁移至React 16，你们将会发现之前未留意过的应用程序存在的崩溃。增加错误边界能够让你在发生异常时提供更好的用户体验。</p>
<p>例如，Facebook Messenger将边栏，信息面板，会话日志以及消息输入的内容包装到单独的错误边界中。若其中某一个组件的UI崩溃了，其余的仍能正常交互。</p>
<p>我们也鼓励你使用JS错误报告服务（或自己构建）以让你能够了解在产品中产生的未处理的异常，并修复它们。</p>
<h2 id="组件栈追踪"><a href="#%E7%BB%84%E4%BB%B6%E6%A0%88%E8%BF%BD%E8%B8%AA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>组件栈追踪</h2>
<p>React 16会打印所有在开发环节中发生在渲染过程的错误到控制台，即使应用程序意外地将他们吞了。除了错误信息和JavaScript堆栈，其还提供了组件栈追踪。闲杂你可以在组件树中精确地查看错误产生的地方：</p>

<p>你也可以在组件堆栈中查看文件名和行数。这一功能在<a href="https://github.com/facebookincubator/create-react-app">Create React App 项目</a>中默认开启：</p>
<p></p>
<p>若你不使用Create React App，你可以手动添加<a href="https://www.npmjs.com/package/babel-plugin-transform-react-jsx-source">该插件</a> 到你的Babel配置中。注意其仅能在开发环境中使用并<strong>禁止在生产环境中使用。</strong></p>
<h2 id="为何不使用try--catch？"><a href="#%E4%B8%BA%E4%BD%95%E4%B8%8D%E4%BD%BF%E7%94%A8try--catch%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为何不使用<code>try</code> / <code>catch</code>？</h2>
<p><code>try</code> / <code>catch</code> 很好但其仅适用于命令式的代码：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">showButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>然而，React组件是声明式的，并指定了什么应该被渲染：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span> <span class="token punctuation">/></span></span>
</code></pre>
      </div>
<p>错误边界保留了React声明式的特性，同时其行为和你期望的一直。例如，即使一个在<code>componentDidUpdate</code>周期由组件树内部底层的<code>setState</code>导致的错误，其仍能够正确地传递到最近的错误边界。</p>
<h2 id="自react-15开始的命名变更"><a href="#%E8%87%AAreact-15%E5%BC%80%E5%A7%8B%E7%9A%84%E5%91%BD%E5%90%8D%E5%8F%98%E6%9B%B4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自React 15开始的命名变更</h2>
<p>React 15 在不同的方法名下为错误边界包含了一个非常有限的支持：<code>unstable_handleError</code>。该方法不再生效，同时自React 16第一个测试版本发布开始，你需要在你的代码中将其修改为<code>componentDidCatch</code>。</p>
<p>为应对这一改变，我们已提供了<a href="https://github.com/reactjs/react-codemod#error-boundaries">一份 codemod</a>以用于自动地迁移你的代码。</p>]]></description><link>https://doc.react-china.org/blog/2017/07/26/error-handle-in-react-16.html</link><guid isPermaLink="false">https://doc.react-china.org/blog/2017/07/26/error-handle-in-react-16.html</guid><pubDate>Wed, 26 Jul 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Error Handling in React 16]]></title><description><![CDATA[<p>As React 16 release is getting closer, we would like to announce a few changes to how React handles JavaScript errors inside components. These changes are included in React 16 beta versions, and will be a part of React 16.</p>
<p><strong>By the way, <a href="https://github.com/facebook/react/issues/10294">we just released the first beta of React 16 for you to try!</a></strong></p>
<h2 id="behavior-in-react-15-and-earlier"><a href="#behavior-in-react-15-and-earlier" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Behavior in React 15 and Earlier</h2>
<p>In the past, JavaScript errors inside components used to corrupt React’s internal state and cause it to <a href="https://github.com/facebook/react/issues/4026">emit</a> <a href="https://github.com/facebook/react/issues/6895">cryptic</a> <a href="https://github.com/facebook/react/issues/8579">errors</a> on next renders. These errors were always caused by an earlier error in the application code, but React did not provide a way to handle them gracefully in components, and could not recover from them.</p>
<h2 id="introducing-error-boundaries"><a href="#introducing-error-boundaries" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introducing Error Boundaries</h2>
<p>A JavaScript error in a part of the UI shouldn’t break the whole app. To solve this problem for React users, React 16 introduces a new concept of an “error boundary”.</p>
<p>Error boundaries are React components that <strong>catch JavaScript errors anywhere in their child component tree, log those errors, and display a fallback UI</strong> instead of the component tree that crashed. Error boundaries catch errors during rendering, in lifecycle methods, and in constructors of the whole tree below them.</p>
<p>A class component becomes an error boundary if it defines a new lifecycle method called <code>componentDidCatch(error, info)</code>:</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token keyword">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> hasError<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="gatsby-highlight-code-line">  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">    <span class="token comment">// Display fallback UI</span>
</span><span class="gatsby-highlight-code-line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hasError<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">    <span class="token comment">// You can also log the error to an error reporting service</span>
</span><span class="gatsby-highlight-code-line">    <span class="token function">logErrorToMyService</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span>
</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">      <span class="token comment">// You can render any custom fallback UI</span>
</span><span class="gatsby-highlight-code-line">      <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Something went wrong<span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span>
</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>Then you can use it as a regular component:</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ErrorBoundary</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MyWidget</span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ErrorBoundary</span><span class="token punctuation">></span></span>
</code></pre>
      </div>
<p>The <code>componentDidCatch()</code> method works like a JavaScript <code>catch {}</code> block, but for components. Only class components can be error boundaries. In practice, most of the time you’ll want to declare an error boundary component once and use it throughout your application.</p>
<p>Note that <strong>error boundaries only catch errors in the components below them in the tree</strong>. An error boundary can’t catch an error within itself. If an error boundary fails trying to render the error message, the error will propagate to the closest error boundary above it. This, too, is similar to how <code>catch {}</code> block works in JavaScript.</p>
<h2 id="live-demo"><a href="#live-demo" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Live Demo</h2>
<p>Check out <a href="https://codepen.io/gaearon/pen/wqvxGa?editors=0010">this example of declaring and using an error boundary</a> with <a href="https://github.com/facebook/react/issues/10294">React 16 beta</a>.</p>
<h2 id="where-to-place-error-boundaries"><a href="#where-to-place-error-boundaries" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Where to Place Error Boundaries</h2>
<p>The granularity of error boundaries is up to you. You may wrap top-level route components to display a “Something went wrong” message to the user, just like server-side frameworks often handle crashes. You may also wrap individual widgets in an error boundary to protect them from crashing the rest of the application.</p>
<h2 id="new-behavior-for-uncaught-errors"><a href="#new-behavior-for-uncaught-errors" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>New Behavior for Uncaught Errors</h2>
<p>This change has an important implication. <strong>As of React 16, errors that were not caught by any error boundary will result in unmounting of the whole React component tree.</strong></p>
<p>We debated this decision, but in our experience it is worse to leave corrupted UI in place than to completely remove it. For example, in a product like Messenger leaving the broken UI visible could lead to somebody sending a message to the wrong person. Similarly, it is worse for a payments app to display a wrong amount than to render nothing.</p>
<p>This change means that as you migrate to React 16, you will likely uncover existing crashes in your application that have been unnoticed before. Adding error boundaries lets you provide better user experience when something goes wrong.</p>
<p>For example, Facebook Messenger wraps content of the sidebar, the info panel, the conversation log, and the message input into separate error boundaries. If some component in one of these UI areas crashes, the rest of them remain interactive.</p>
<p>We also encourage you to use JS error reporting services (or build your own) so that you can learn about unhandled exceptions as they happen in production, and fix them.</p>
<h2 id="component-stack-traces"><a href="#component-stack-traces" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Component Stack Traces</h2>
<p>React 16 prints all errors that occurred during rendering to the console in development, even if the application accidentally swallows them. In addition to the error message and the JavaScript stack, it also provides component stack traces. Now you can see where exactly in the component tree the failure has happened:</p>

<p>You can also see the filenames and line numbers in the component stack trace. This works by default in <a href="https://github.com/facebookincubator/create-react-app">Create React App</a> projects:</p>

<p>If you don’t use Create React App, you can add <a href="https://www.npmjs.com/package/babel-plugin-transform-react-jsx-source">this plugin</a> manually to your Babel configuration. Note that it’s intended only for development and <strong>must be disabled in production</strong>.</p>
<h2 id="why-not-use-try--catch"><a href="#why-not-use-try--catch" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why Not Use <code>try</code> / <code>catch</code>?</h2>
<p><code>try</code> / <code>catch</code> is great but it only works for imperative code:</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">showButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>However, React components are declarative and specify <em>what</em> should be rendered:</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span> <span class="token punctuation">/></span></span>
</code></pre>
      </div>
<p>Error boundaries preserve the declarative nature of React, and behave as you would expect. For example, even if an error occurs in a <code>componentDidUpdate</code> hook caused by a <code>setState</code> somewhere deep in the tree, it will still correctly propagate to the closest error boundary.</p>
<h2 id="naming-changes-from-react-15"><a href="#naming-changes-from-react-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Naming Changes from React 15</h2>
<p>React 15 included a very limited support for error boundaries under a different method name: <code>unstable_handleError</code>. This method no longer works, and you will need to change it to <code>componentDidCatch</code> in your code starting from the first 16 beta release.</p>
<p>For this change, we’ve provided <a href="https://github.com/reactjs/react-codemod#error-boundaries">a codemod</a> to automatically migrate your code.</p>]]></description><link>https://doc.react-china.org/blog/2017/07/26/error-handling-in-react-16.html</link><guid isPermaLink="false">https://doc.react-china.org/blog/2017/07/26/error-handling-in-react-16.html</guid><pubDate>Wed, 26 Jul 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[React v15.6.0]]></title><description><![CDATA[<p>今天我们发布了 React 15.6.0。由于我们在准备React 16.0，因此我们修复和清理了许多东西。此次发布将继续为后续铺路。</p>
<h2 id="提升inputs"><a href="#%E6%8F%90%E5%8D%87inputs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>提升Inputs</h2>
<p>在React 15.6.0，输入框的<code>onChange</code>事件稍微可靠了点并能够处理更多边界条件，涵盖以下：</p>
<ul>
<li>当单选按钮被点击但未改变时事件未触发（<a href="https://github.com/facebook/react/issues/1471">issue 1471</a>）</li>
<li>用方向键（arrow keys）修改<code>范围（range）</code>类型的输入框（<a href="https://github.com/facebook/react/issues/554">issue 554</a>）</li>
<li>在IE 11复制文本到文本框中（<a href="https://github.com/facebook/react/issues/7211">issue 7211</a>）</li>
<li>在IE 11自动填充（<a href="https://github.com/facebook/react/issues/6614">issue 6614</a>）</li>
<li>在IE 11中通过’x’键或右键’删除’清空输入框（<a href="https://github.com/facebook/react/issues/6822">issue 6822</a>）</li>
<li>在IE 11中渲染输入框中已存在字符时事件未触发（<a href="https://github.com/facebook/react/issues/2185">issue 2185</a>）</li>
</ul>
<p>感谢<a href="https://github.com/jquense">Jason Quense</a>以及其他帮助解决上述问题和提出PR的各位。</p>
<h2 id="更少嘈杂的弃用警告"><a href="#%E6%9B%B4%E5%B0%91%E5%98%88%E6%9D%82%E7%9A%84%E5%BC%83%E7%94%A8%E8%AD%A6%E5%91%8A" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>更少嘈杂的弃用警告</h2>
<p>我们还为之后的弃用引入了一系列新的警告。这些并不会影响大多数用户，更多细节可以查看下面的修改日志。</p>
<p>自上次发布之后，我们从社区得到了一些有价值的反馈，弃用警告会产生噪音并使得测试失败。<strong>在React 15.6，我们采用<code>console.warn</code>而不是<code>console.error</code>来对弃用警告进行降级处理</strong>。我们的其他警告将仍使用<code>console.error</code>因为他们面对的可能是引发异常的棘手问题。不同于我们其他警告，弃用警告可以延期修复并且不会在发布环节对你的引用造成问题。我们认为降低弃用警告的紧急程度将会让你在下个版本的升级中更为容易。感谢参与这一问题讨论的各位。</p>
<hr>
<h2 id="安装"><a href="#%E5%AE%89%E8%A3%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装</h2>
<p>我们推荐使用 <a href="https://yarnpkg.com/">Yarn</a> 或 <a href="https://www.npmjs.com/">npm</a> 来管理前端依赖。若你是初次接触包管理器，<a href="https://yarnpkg.com/en/docs/getting-started">Yarn 文档</a>是一个不错的起点。</p>
<p>通过 Yarn 安装 React，运行：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-bash"><code>yarn add react@^15.6.0 react-dom@^15.6.0
</code></pre>
      </div>
<p>通过 npm 安装 React，运行：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save react@^15.6.0 react-dom@^15.6.0
</code></pre>
      </div>
<p>我们推荐如 <a href="https://webpack.js.org/">webpack</a> 或 <a href="http://browserify.org/">Browserify</a> 打包器，以让你可以编写模块化代码并将其打包到一起放在一个小的包内以优化加载时间。</p>
<p>记住默认情况下，React 在开发模式下运行会带有额外检查并提供有用的警告。当部署你的应用时，确保其<a href="/react/docs/installation.html#development-and-production-versions">在生产模式编译</a>。</p>
<p>万一你未使用打包器，我们也提供了一个预先构建好的包在npm上，你可以在你的页面中<a href="/react/docs/installation.html#using-a-cdn">通过script标签引入</a>：</p>
<ul>
<li><strong>React</strong><br/>
带警告的开发版本: <a href="https://unpkg.com/react@15.6.0/dist/react.js">react/dist/react.js</a><br/>
用于生产的压缩版本: <a href="https://unpkg.com/react@15.6.0/dist/react.min.js">react/dist/react.min.js</a><br/></li>
<li><strong>React with Add-Ons</strong><br/>
带警告的开发版本: <a href="https://unpkg.com/react@15.6.0/dist/react-with-addons.js">react/dist/react-with-addons.js</a><br/>
用于生产的压缩版本: <a href="https://unpkg.com/react@15.5.0/dist/react-with-addons.min.js">react/dist/react-with-addons.min.js</a><br/></li>
<li><strong>React DOM</strong> (页面中在React DOM之前引入React) <br/>
带警告的开发版本: <a href="https://unpkg.com/react-dom@15.6.0/dist/react-dom.js">react-dom/dist/react-dom.js</a><br/>
用于生产的压缩版本: <a href="https://unpkg.com/react-dom@15.6.0/dist/react-dom.min.js">react-dom/dist/react-dom.min.js</a><br/></li>
<li><strong>React DOM Server</strong> (页面中在 React DOM Server 之前引入 React)<br/>
带警告的开发版本: <a href="https://unpkg.com/react-dom@15.6.0/dist/react-dom-server.js">react-dom/dist/react-dom-server.js</a><br/>
用于生产的压缩版本: <a href="https://unpkg.com/react-dom@15.6.0/dist/react-dom-server.min.js">react-dom/dist/react-dom-server.min.js</a><br/></li>
</ul>
<p>我们还在 npm 上发布了 <code>react</code>，<code>react-dom</code> 及附件包的<code>15.6.0</code> 版本以及在bower上的 <code>react</code> 包。</p>
<hr>
<h2 id="修改日志"><a href="#%E4%BF%AE%E6%94%B9%E6%97%A5%E5%BF%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修改日志</h2>
<h2 id="1560-june-13-2017"><a href="#1560-june-13-2017" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>15.6.0 (June 13, 2017)</h2>
<h3 id="react"><a href="#react" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React</h3>
<ul>
<li>采用<code>console.warn</code>而不是<code>console.error</code>来降级处理弃用警告。(<a href="https://github.com/flarnie">@flarnie</a> 在 <a href="https://github.com/facebook/react/pull/9753">#9753</a> 的提交)</li>
<li>为<code>React.createClass</code>增加弃用警告。将用户指向<code>create-react-class</code>。(<a href="https://github.com/flarnie">@flarnie</a> 在 <a href="https://github.com/facebook/react/pull/9771">#9771</a> 的提交)</li>
<li>增加弃用警告并为<code>React.DOM</code>工厂辅助方法分离为新模块。(<a href="https://github.com/nhunzaker">@nhunzaker</a> 在 <a href="https://github.com/facebook/react/pull/8356">#8356</a> 的提交)</li>
<li><code>React.createMixin</code>的弃用警告辅助方法将不再使用。(<a href="https://github.com/aweary">@aweary</a> 在 <a href="https://github.com/facebook/react/pull/8853">#8853</a> 的提交)</li>
</ul>
<h3 id="react-dom"><a href="#react-dom" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React DOM</h3>
<ul>
<li>在<code>style</code>属性中增加CSS变量支持。 (<a href="https://github.com/aweary">@aweary</a> 在 <a href="https://github.com/facebook/react/pull/9302">#9302</a> 的提交)</li>
<li>增加CSS网格(Grid)样式属性支持。(<a href="https://github.com/ericsakmar">@ericsakmar</a> 在 <a href="https://github.com/facebook/react/pull/9185">#9185</a> 的提交)</li>
<li>修复输入框改变可变值类型异常。(<a href="https://github.com/mhunzaker">@nhunzaker</a> 在 <a href="https://github.com/facebook/react/pull/9806">#9806</a> 的提交)</li>
<li>修复在某些输入场景下<code>onChange</code>未触发的问题。(<a href="https://github.com/jquense">@jquense</a> 在 <a href="https://github.com/facebook/react/pull/8575">#8575</a> 的提交)</li>
<li>修复控制数字输入框错误允许期间的异常。(<a href="https://github.com/nhunzaker">@nhunzaker</a> 在 <a href="https://github.com/facebook/react/pull/9584">#9584</a> 的提交)</li>
<li>修复性能记录(performance entry)被清除的bug。(<a href="https://github.com/chrisui">@chrisui</a> 在 <a href="https://github.com/facebook/react/pull/9451">#9451</a> 的提交)</li>
</ul>]]></description><link>https://doc.react-china.org/blog/2017/06/13/react-v15.6.0.html</link><guid isPermaLink="false">https://doc.react-china.org/blog/2017/06/13/react-v15.6.0.html</guid><pubDate>Tue, 13 Jun 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[What's New in Create React App]]></title><description><![CDATA[<p>Less than a year ago, we introduced <a href="/blog/2016/07/22/create-apps-with-no-configuration.html">Create React App</a> as an officially supported way to create apps with zero configuration. The project has since enjoyed tremendous growth, with over 950 commits by more than 250 contributors.</p>
<p>Today, we are excited to announce that many features that have been in the pipeline for the last few months are finally released.</p>
<p>As usual with Create React App, <strong>you can enjoy these improvements in your existing non-ejected apps by updating a single dependency</strong> and following our <a href="https://github.com/facebookincubator/create-react-app/releases/tag/v1.0.0">migration instructions</a>.</p>
<p>Newly created apps will get these improvements automatically.</p>
<h3 id="webpack-2"><a href="#webpack-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack 2</h3>
<blockquote>
<p><em>This change was contributed by <a href="https://github.com/Timer">@Timer</a> in <a href="https://github.com/facebookincubator/create-react-app/pull/1291">#1291</a>.</em></p>
</blockquote>
<p>We have upgraded to webpack 2 which has been <a href="https://medium.com/webpack/webpack-2-and-beyond-40520af9067f">officially released</a> a few months ago. It is a big upgrade with many bugfixes and general improvements. We have been testing it for a while, and now consider it stable enough to recommend it to everyone.</p>
<p>While the Webpack configuration format has changed, Create React App users who didn’t eject don’t need to worry about it as we have updated the configuration on our side.</p>
<p>If you had to eject your app for one reason or another, Webpack provides a <a href="https://webpack.js.org/guides/migrating/">configuration migration guide</a> that you can follow to update your apps. Note that with each release of Create React App, we are working to support more use cases out of the box so that you don’t have to eject in the future.</p>
<p>The biggest notable webpack 2 feature is the ability to write and import <a href="http://2ality.com/2014/09/es6-modules-final.html">ES6 modules</a> directly without compiling them to CommonJS. This shouldn’t affect how you write code since you likely already use <code>import</code> and <code>export</code> statements, but it will help catch more mistakes like missing named exports at compile time:</p>
<p><img src="../img/blog/cra-update-exports.gif" alt="Export validation"> </p>
<p>In the future, as the ecosystem around ES6 modules matures, you can expect more improvements to your app’s bundle size thanks to <a href="https://webpack.js.org/guides/tree-shaking/">tree shaking</a>.</p>
<h3 id="runtime-error-overlay"><a href="#runtime-error-overlay" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Runtime Error Overlay</h3>
<blockquote>
<p><em>This change was contributed by <a href="https://github.com/Timer">@Timer</a> and <a href="https://github.com/nicinabox">@nicinabox</a> in <a href="https://github.com/facebookincubator/create-react-app/pull/1101">#1101</a>, <a href="https://github.com/bvaughn">@bvaughn</a> in <a href="https://github.com/facebookincubator/create-react-app/pull/2201">#2201</a>.</em></p>
</blockquote>
<p>Have you ever made a mistake in code and only realized it after the console is flooded with cryptic errors? Or worse, have you ever shipped an app with crashes in production because you accidentally missed an error in development?</p>
<p>To address these issues, we are introducing an overlay that pops up whenever there is an uncaught error in your application. It only appears in development, and you can dismiss it by pressing Escape. </p>
<p>A GIF is worth a thousand words:
<br>
<img src="../img/blog/cra-runtime-error.gif" alt="Runtime error overlay"> </p>
<p>(Yes, it integrates with your editor!)</p>
<p>In the future, we plan to teach the runtime error overlay to understand more about your React app. For example, after React 16 we plan to show React component stacks in addition to the JavaScript stacks when an error is thrown.</p>
<h3 id="progressive-web-apps-by-default"><a href="#progressive-web-apps-by-default" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Progressive Web Apps by Default</h3>
<blockquote>
<p><em>This change was contributed by <a href="https://github.com/jeffposnick">@jeffposnick</a> in <a href="https://github.com/facebookincubator/create-react-app/pull/1728">#1728</a>.</em></p>
</blockquote>
<p>Newly created projects are built as <a href="https://developers.google.com/web/progressive-web-apps/">Progressive Web Apps</a> by default. This means that they employ <a href="https://developers.google.com/web/fundamentals/getting-started/primers/service-workers">service workers</a> with an <a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#cache-falling-back-to-network">offline-first caching strategy</a> to minimize the time it takes to serve the app to the users who visit it again. You can opt out of this behavior, but we recommend it both for new and existing apps, especially if you target mobile devices.</p>
<p> </p>
<p>New apps automatically have these features, but you can easily convert an existing project to a Progressive Web App  by following <a href="https://github.com/facebookincubator/create-react-app/releases/tag/v1.0.0">our migration guide</a>.</p>
<p>We will be adding <a href="https://github.com/facebookincubator/create-react-app/blob/master/packages/react-scripts/template/README.md#making-a-progressive-web-app">more documentation</a> on this topic in the coming weeks. Please feel free to <a href="https://github.com/facebookincubator/create-react-app/issues/new">ask any questions</a> on the issue tracker!</p>
<h3 id="jest-20"><a href="#jest-20" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Jest 20</h3>
<blockquote>
<p><em>This change was contributed by <a href="https://github.com/rogeliog">@rogeliog</a> in <a href="https://github.com/facebookincubator/create-react-app/pull/1614">#1614</a> and <a href="https://github.com/gaearon">@gaearon</a> in <a href="https://github.com/facebookincubator/create-react-app/pull/2171">#2171</a>.</em></p>
</blockquote>
<p>We are now using the latest version of Jest that includes numerous bugfixes and improvements. You can read more about the changes in <a href="https://facebook.github.io/jest/blog/2017/02/21/jest-19-immersive-watch-mode-test-platform-improvements.html">Jest 19</a> and <a href="http://facebook.github.io/jest/blog/2017/05/06/jest-20-delightful-testing-multi-project-runner.html">Jest 20</a> blog posts.</p>
<p>Highlights include a new <a href="https://facebook.github.io/jest/blog/2017/02/21/jest-19-immersive-watch-mode-test-platform-improvements.html#immersive-watch-mode">immersive watch mode</a>, <a href="https://facebook.github.io/jest/blog/2017/02/21/jest-19-immersive-watch-mode-test-platform-improvements.html#snapshot-updates">a better snapshot format</a>, <a href="https://facebook.github.io/jest/blog/2017/02/21/jest-19-immersive-watch-mode-test-platform-improvements.html#improved-printing-of-skipped-tests">improvements to printing skipped tests</a>, and <a href="https://facebook.github.io/jest/blog/2017/05/06/jest-20-delightful-testing-multi-project-runner.html#new-improved-testing-apis">new testing APIs</a>.</p>
<p><img src="../img/blog/cra-jest-search.gif" alt="Immersive test watcher"> </p>
<p>Additionally, Create React App now support configuring a few Jest options related to coverage reporting.</p>
<h3 id="code-splitting-with-dynamic-import"><a href="#code-splitting-with-dynamic-import" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Code Splitting with Dynamic import()</h3>
<blockquote>
<p><em>This change was contributed by <a href="https://github.com/Timer">@Timer</a> in <a href="https://github.com/facebookincubator/create-react-app/pull/1538">#1538</a> and <a href="https://github.com/tharakawj">@tharakawj</a> in <a href="https://github.com/facebookincubator/create-react-app/pull/1801">#1801</a>.</em></p>
</blockquote>
<p>It is important to keep the initial JavaScript payload of web apps down to the minimum, and <a href="https://medium.com/@addyosmani/progressive-web-apps-with-react-js-part-2-page-load-performance-33b932d97cf2">load the rest of the code on demand</a>. Although Create React App supported <a href="https://webpack.js.org/guides/code-splitting-async/">code splitting</a> using <code>require.ensure()</code> since the first release, it used a webpack-specific syntax that did not work in Jest or other environments.</p>
<p>In this release, we are adding support for the <a href="http://2ality.com/2017/01/import-operator.html#loading-code-on-demand">dynamic <code>import()</code> proposal</a> which aligns with the future web standards. Unlike <code>require.ensure()</code>, it doesn’t break Jest tests, and should eventually become a part of JavaScript. We encourage you to use <code>import()</code> to delay loading the code for non-critical component subtrees until you need to render them.</p>
<p><img src="../img/blog/cra-dynamic-import.gif" alt="Creating chunks with dynamic import"></p>
<h3 id="better-console-output"><a href="#better-console-output" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Better Console Output</h3>
<blockquote>
<p><em>This change was contributed by <a href="https://github.com/gaearon">@gaearon</a> in <a href="https://github.com/facebookincubator/create-react-app/pull/2120">#2120</a>, <a href="https://github.com/facebookincubator/create-react-app/pull/2125">#2125</a>, and <a href="https://github.com/facebookincubator/create-react-app/pull/2161">#2161</a>.</em></p>
</blockquote>
<p>We have improved the console output across the board.</p>
<p>For example, when you start the development server, we now display the LAN address in additional to the localhost address so that you can quickly access the app from a mobile device on the same network:</p>
<p> </p>
<p>When lint errors are reported, we no longer show the warnings so that you can concentrate on more critical issues. Errors and warnings in the production build output are better formatted, and the build error overlay font size now matches the browser font size more closely.</p>
<h3 id="but-wait-theres-more"><a href="#but-wait-theres-more" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>But Wait… There’s More!</h3>
<p>You can only fit so much in a blog post, but there are other long-requested features in this release, such as <a href="https://github.com/facebookincubator/create-react-app/pull/1344">environment-specific and local <code>.env</code> files</a>, <a href="https://github.com/facebookincubator/create-react-app/pull/2130">a lint rule against confusingly named globals</a>, <a href="https://github.com/facebookincubator/create-react-app/pull/1790">support for multiple proxies in development</a>, <a href="https://github.com/facebookincubator/create-react-app/pull/1590">a customizable browser launch script</a>, and many bugfixes.</p>
<p>You can read the full changelog and the migration guide in the <a href="https://github.com/facebookincubator/create-react-app/releases/tag/v1.0.0">v1.0.0 release notes</a>.</p>
<h3 id="acknowledgements"><a href="#acknowledgements" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Acknowledgements</h3>
<p>This release is a result of months of work from many people in the React community. It is focused on improving both developer and end user experience, as we believe they are complementary and go hand in hand.</p>
<p>We are grateful to <a href="https://github.com/facebookincubator/create-react-app/graphs/contributors">everyone who has offered their contributions</a>, whether in code, documentation, or by helping other people. We would like to specifically thank <a href="https://github.com/timer">Joe Haddad</a> for his invaluable help maintaining the project.</p>
<p>We are excited to bring these improvements to everybody using Create React App, and we are looking forward to more of your feedback and contributions.</p>]]></description><link>https://doc.react-china.org/blog/2017/05/18/whats-new-in-create-react-app.html</link><guid isPermaLink="false">https://doc.react-china.org/blog/2017/05/18/whats-new-in-create-react-app.html</guid><pubDate>Thu, 18 May 2017 00:00:00 GMT</pubDate></item></channel></rss>